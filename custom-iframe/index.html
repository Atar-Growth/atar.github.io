
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Atar Integration Docs">
      
      
        <meta name="author" content="Atar Growth">
      
      
        <link rel="canonical" href="https://atar-growth.github.io/custom-iframe/">
      
      
        <link rel="prev" href="../custom-api/">
      
      
      
      <link rel="icon" href="../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.26">
    
    
      
        <title>Webview / iFrame Integration - Atar Integration Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#atar-webview-iframe-integration" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Atar Integration Docs" class="md-header__button md-logo" aria-label="Atar Integration Docs" data-md-component="logo">
      
  <img src="../images/logo-light.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Atar Integration Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Webview / iFrame Integration
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Atar Integration Docs" class="md-nav__button md-logo" aria-label="Atar Integration Docs" data-md-component="logo">
      
  <img src="../images/logo-light.png" alt="logo">

    </a>
    Atar Integration Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ios-sdk/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    iOS SDK
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../android-sdk/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Android SDK
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../custom-api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API Integration
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Webview / iFrame Integration
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Webview / iFrame Integration
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-create-an-account-and-get-your-app-key" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Create an account and get your App Key
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-create-the-url-for-the-offer-webview-or-iframe" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Create the URL for the offer Webview or iFrame
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 2: Create the URL for the offer Webview or iFrame">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#full-parameter-list-with-explanation" class="md-nav__link">
    <span class="md-ellipsis">
      Full parameter list with explanation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-handle-click-or-cancel-callbacks-from-the-webview" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Handle click or cancel callbacks from the webview
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 3: Handle click or cancel callbacks from the webview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ios-callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      iOS Callbacks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="iOS Callbacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-3a-declare-your-webview-delegate" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3.a. Declare your webview delegate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3b-register-the-script-message-handler" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3.b. Register the script message handler
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3c-implement-the-delegate-method" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3.c. Implement the delegate method
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#android-callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      Android Callbacks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Android Callbacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-3a-register-the-javascript-interface-and-implement-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3.a. Register the Javascript interface and implement handling
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-implement-your-custom-cancel-button" class="md-nav__link">
    <span class="md-ellipsis">
      Step 4: Implement your custom cancel button
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 4: Implement your custom cancel button">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ios-cancel-button" class="md-nav__link">
    <span class="md-ellipsis">
      iOS Cancel Button
    </span>
  </a>
  
    <nav class="md-nav" aria-label="iOS Cancel Button">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#android-cancel-button" class="md-nav__link">
    <span class="md-ellipsis">
      Android Cancel Button
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#appendix-full-example-webview-interstitial-presentation" class="md-nav__link">
    <span class="md-ellipsis">
      Appendix: Full example webview interstitial presentation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Appendix: Full example webview interstitial presentation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ios-interstitial-view-example" class="md-nav__link">
    <span class="md-ellipsis">
      iOS Interstitial View Example
    </span>
  </a>
  
    <nav class="md-nav" aria-label="iOS Interstitial View Example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-the-below-ios-interstitial" class="md-nav__link">
    <span class="md-ellipsis">
      Using the below iOS interstitial
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webview-interstitial-view-in-ios" class="md-nav__link">
    <span class="md-ellipsis">
      Webview interstitial view in iOS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#android-interstitial-view-example" class="md-nav__link">
    <span class="md-ellipsis">
      Android Interstitial View Example
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Android Interstitial View Example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-the-below-android-interstitial" class="md-nav__link">
    <span class="md-ellipsis">
      Using the below Android interstitial
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webview-interstitial-view-in-android" class="md-nav__link">
    <span class="md-ellipsis">
      Webview interstitial view in Android
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#need-help" class="md-nav__link">
    <span class="md-ellipsis">
      Need help?
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-create-an-account-and-get-your-app-key" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Create an account and get your App Key
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-create-the-url-for-the-offer-webview-or-iframe" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Create the URL for the offer Webview or iFrame
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 2: Create the URL for the offer Webview or iFrame">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#full-parameter-list-with-explanation" class="md-nav__link">
    <span class="md-ellipsis">
      Full parameter list with explanation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-handle-click-or-cancel-callbacks-from-the-webview" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Handle click or cancel callbacks from the webview
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 3: Handle click or cancel callbacks from the webview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ios-callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      iOS Callbacks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="iOS Callbacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-3a-declare-your-webview-delegate" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3.a. Declare your webview delegate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3b-register-the-script-message-handler" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3.b. Register the script message handler
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3c-implement-the-delegate-method" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3.c. Implement the delegate method
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#android-callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      Android Callbacks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Android Callbacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-3a-register-the-javascript-interface-and-implement-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3.a. Register the Javascript interface and implement handling
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-implement-your-custom-cancel-button" class="md-nav__link">
    <span class="md-ellipsis">
      Step 4: Implement your custom cancel button
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 4: Implement your custom cancel button">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ios-cancel-button" class="md-nav__link">
    <span class="md-ellipsis">
      iOS Cancel Button
    </span>
  </a>
  
    <nav class="md-nav" aria-label="iOS Cancel Button">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#android-cancel-button" class="md-nav__link">
    <span class="md-ellipsis">
      Android Cancel Button
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#appendix-full-example-webview-interstitial-presentation" class="md-nav__link">
    <span class="md-ellipsis">
      Appendix: Full example webview interstitial presentation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Appendix: Full example webview interstitial presentation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ios-interstitial-view-example" class="md-nav__link">
    <span class="md-ellipsis">
      iOS Interstitial View Example
    </span>
  </a>
  
    <nav class="md-nav" aria-label="iOS Interstitial View Example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-the-below-ios-interstitial" class="md-nav__link">
    <span class="md-ellipsis">
      Using the below iOS interstitial
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webview-interstitial-view-in-ios" class="md-nav__link">
    <span class="md-ellipsis">
      Webview interstitial view in iOS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#android-interstitial-view-example" class="md-nav__link">
    <span class="md-ellipsis">
      Android Interstitial View Example
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Android Interstitial View Example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-the-below-android-interstitial" class="md-nav__link">
    <span class="md-ellipsis">
      Using the below Android interstitial
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webview-interstitial-view-in-android" class="md-nav__link">
    <span class="md-ellipsis">
      Webview interstitial view in Android
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#need-help" class="md-nav__link">
    <span class="md-ellipsis">
      Need help?
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="atar-webview-iframe-integration">Atar Webview / iFrame Integration</h1>
<p>The guide below will walk you through the steps to integrate Atar into your app via an iFrame or Webview inside your Android or iOS app.</p>
<h2 id="step-1-create-an-account-and-get-your-app-key">Step 1: Create an account and get your App Key</h2>
<p>If you haven't already, create an account on the <a href="https://app.atargrowth.com/">Atar Dashboard</a>. Once you've created an account, you'll be able to create an app and get your App Key from the <a href="https://app.atargrowth.com/settings">settings page</a>.</p>
<h2 id="step-2-create-the-url-for-the-offer-webview-or-iframe">Step 2: Create the URL for the offer Webview or iFrame</h2>
<p>Offers can be retrieved from Atar by constructing a personalized URL to the user, and loading the URL in your app. The GET request on the URL will return an HTML page that can be rendered and presented directly.</p>
<p>The URL structure is as follows:
<div class="language-html highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>https://api.atargrowth.com/offers
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    ?   aK=<span class="p">&lt;</span><span class="nt">your</span> <span class="na">app</span> <span class="na">key</span><span class="p">&gt;</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a># App metadata
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="err">&amp;</span>   bId=<span class="p">&lt;</span><span class="nt">the</span> <span class="na">bundle</span> <span class="na">ID</span> <span class="na">or</span> <span class="na">package</span> <span class="na">name</span><span class="p">&gt;</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="err">&amp;</span>   aV=<span class="p">&lt;</span><span class="nt">the</span> <span class="na">app</span> <span class="na">version</span><span class="p">&gt;</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="err">&amp;</span>   os=<span class="p">&lt;</span><span class="nt">ios</span> <span class="na">or</span> <span class="na">android</span><span class="p">&gt;</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="err">&amp;</span>   platform=<span class="p">&lt;</span><span class="nt">phone</span><span class="err">,</span> <span class="na">tablet</span><span class="err">,</span> <span class="na">web</span><span class="err">,</span> <span class="na">etc</span><span class="err">.</span><span class="p">&gt;</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a># User and event specific parameters
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    <span class="err">&amp;</span>   userId=<span class="p">&lt;</span><span class="nt">the</span> <span class="na">user</span> <span class="na">ID</span><span class="p">&gt;</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    <span class="err">&amp;</span>   referenceId=<span class="p">&lt;</span><span class="nt">an</span> <span class="na">event</span> <span class="na">reference</span> <span class="na">ID</span><span class="p">&gt;</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>    <span class="err">&amp;</span>   event=<span class="p">&lt;</span><span class="nt">the</span> <span class="na">user</span> <span class="na">event</span><span class="p">&gt;</span>
</span></code></pre></div></p>
<p>Here are some examples of constructing the URL in different languages:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:4"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><input id="__tabbed_1_3" name="__tabbed_1" type="radio" /><input id="__tabbed_1_4" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">iOS Swift</label><label for="__tabbed_1_2">iOS Objective C</label><label for="__tabbed_1_3">Android Kotlin</label><label for="__tabbed_1_4">Android Java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-swift highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">guard</span> <span class="kd">var</span> <span class="nv">components</span> <span class="p">=</span> <span class="n">URLComponents</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="s">&quot;https://api.atargrowth.com/offers&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">nil</span> <span class="p">}</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">components</span><span class="p">.</span><span class="n">queryItems</span> <span class="p">=</span> <span class="p">[</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    <span class="n">URLQueryItem</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="s">&quot;aK&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="s">&quot;your app key&quot;</span><span class="p">),</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>    <span class="n">URLQueryItem</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="s">&quot;bId&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Bundle</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">bundleIdentifier</span> <span class="p">??</span> <span class="s">&quot;&quot;</span><span class="p">),</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>    <span class="n">URLQueryItem</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="s">&quot;aV&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Bundle</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">infoDictionary</span><span class="p">?[</span><span class="s">&quot;CFBundleShortVersionString&quot;</span><span class="p">]</span> <span class="k">as</span><span class="p">?</span> <span class="nb">String</span> <span class="p">??</span> <span class="s">&quot;&quot;</span><span class="p">),</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>    <span class="n">URLQueryItem</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="s">&quot;os&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="s">&quot;ios&quot;</span><span class="p">),</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>    <span class="n">URLQueryItem</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="s">&quot;platform&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="bp">UIDevice</span><span class="p">.</span><span class="n">current</span><span class="p">.</span><span class="n">model</span><span class="p">),</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>    <span class="n">URLQueryItem</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="s">&quot;userId&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="s">&quot;userId1234&quot;</span><span class="p">),</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>    <span class="n">URLQueryItem</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="s">&quot;referenceId&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="s">&quot;12345&quot;</span><span class="p">),</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>    <span class="n">URLQueryItem</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="s">&quot;event&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="s">&quot;purchase&quot;</span><span class="p">)</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="p">]</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="kd">let</span> <span class="nv">url</span> <span class="p">=</span> <span class="n">components</span><span class="p">.</span><span class="n">url</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="bp">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-objc highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="bp">NSURLComponents</span><span class="w"> </span><span class="o">*</span><span class="n">components</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="bp">NSURLComponents</span><span class="w"> </span><span class="n">componentsWithString</span><span class="o">:</span><span class="s">@&quot;https://api.atargrowth.com/offers&quot;</span><span class="p">];</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="n">components</span><span class="p">.</span><span class="n">queryItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="l">@[</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span><span class="p">[</span><span class="bp">NSURLQueryItem</span><span class="w"> </span><span class="n">queryItemWithName</span><span class="o">:</span><span class="s">@&quot;aK&quot;</span><span class="w"> </span><span class="n">value</span><span class="o">:</span><span class="s">@&quot;your app key&quot;</span><span class="p">],</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">    </span><span class="p">[</span><span class="bp">NSURLQueryItem</span><span class="w"> </span><span class="n">queryItemWithName</span><span class="o">:</span><span class="s">@&quot;bId&quot;</span><span class="w"> </span><span class="n">value</span><span class="o">:</span><span class="p">[[</span><span class="bp">NSBundle</span><span class="w"> </span><span class="n">mainBundle</span><span class="p">]</span><span class="w"> </span><span class="n">bundleIdentifier</span><span class="p">]</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">@&quot;&quot;</span><span class="p">],</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">    </span><span class="p">[</span><span class="bp">NSURLQueryItem</span><span class="w"> </span><span class="n">queryItemWithName</span><span class="o">:</span><span class="s">@&quot;aV&quot;</span><span class="w"> </span><span class="n">value</span><span class="o">:</span><span class="p">[[</span><span class="bp">NSBundle</span><span class="w"> </span><span class="n">mainBundle</span><span class="p">]</span><span class="w"> </span><span class="n">infoDictionary</span><span class="p">][</span><span class="s">@&quot;CFBundleShortVersionString&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">@&quot;&quot;</span><span class="p">],</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">    </span><span class="p">[</span><span class="bp">NSURLQueryItem</span><span class="w"> </span><span class="n">queryItemWithName</span><span class="o">:</span><span class="s">@&quot;os&quot;</span><span class="w"> </span><span class="n">value</span><span class="o">:</span><span class="s">@&quot;ios&quot;</span><span class="p">],</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">    </span><span class="p">[</span><span class="bp">NSURLQueryItem</span><span class="w"> </span><span class="n">queryItemWithName</span><span class="o">:</span><span class="s">@&quot;platform&quot;</span><span class="w"> </span><span class="n">value</span><span class="o">:</span><span class="p">[</span><span class="bp">UIDevice</span><span class="w"> </span><span class="n">currentDevice</span><span class="p">].</span><span class="n">model</span><span class="p">],</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">    </span><span class="p">[</span><span class="bp">NSURLQueryItem</span><span class="w"> </span><span class="n">queryItemWithName</span><span class="o">:</span><span class="s">@&quot;userId&quot;</span><span class="w"> </span><span class="n">value</span><span class="o">:</span><span class="s">@&quot;userId1234&quot;</span><span class="p">],</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">    </span><span class="p">[</span><span class="bp">NSURLQueryItem</span><span class="w"> </span><span class="n">queryItemWithName</span><span class="o">:</span><span class="s">@&quot;referenceId&quot;</span><span class="w"> </span><span class="n">value</span><span class="o">:</span><span class="s">@&quot;12345&quot;</span><span class="p">],</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">    </span><span class="p">[</span><span class="bp">NSURLQueryItem</span><span class="w"> </span><span class="n">queryItemWithName</span><span class="o">:</span><span class="s">@&quot;event&quot;</span><span class="w"> </span><span class="n">value</span><span class="o">:</span><span class="s">@&quot;purchase&quot;</span><span class="p">]</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="l">]</span><span class="p">;</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="bp">NSURL</span><span class="w"> </span><span class="o">*</span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">components</span><span class="p">.</span><span class="n">URL</span><span class="p">;</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;URL: %@&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">url</span><span class="p">);</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kd">val</span><span class="w"> </span><span class="nv">components</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Uri</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="s">&quot;https://api.atargrowth.com/offers&quot;</span><span class="p">).</span><span class="na">buildUpon</span><span class="p">()</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">    </span><span class="p">.</span><span class="na">appendQueryParameter</span><span class="p">(</span><span class="s">&quot;aK&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;your app key&quot;</span><span class="p">)</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">    </span><span class="p">.</span><span class="na">appendQueryParameter</span><span class="p">(</span><span class="s">&quot;bId&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">packageName</span><span class="p">)</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">    </span><span class="p">.</span><span class="na">appendQueryParameter</span><span class="p">(</span><span class="s">&quot;aV&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">packageManager</span><span class="p">.</span><span class="na">getPackageInfo</span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="na">packageName</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">).</span><span class="na">versionName</span><span class="p">)</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">    </span><span class="p">.</span><span class="na">appendQueryParameter</span><span class="p">(</span><span class="s">&quot;os&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;android&quot;</span><span class="p">)</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">    </span><span class="p">.</span><span class="na">appendQueryParameter</span><span class="p">(</span><span class="s">&quot;platform&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;phone&quot;</span><span class="p">)</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">    </span><span class="p">.</span><span class="na">appendQueryParameter</span><span class="p">(</span><span class="s">&quot;userId&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;userId1234&quot;</span><span class="p">)</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">    </span><span class="p">.</span><span class="na">appendQueryParameter</span><span class="p">(</span><span class="s">&quot;referenceId&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;12345&quot;</span><span class="p">)</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">    </span><span class="p">.</span><span class="na">appendQueryParameter</span><span class="p">(</span><span class="s">&quot;event&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;purchase&quot;</span><span class="p">)</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">    </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="n">println</span><span class="p">(</span><span class="n">components</span><span class="p">.</span><span class="na">toString</span><span class="p">())</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-java highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">Uri</span><span class="p">.</span><span class="na">Builder</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Uri</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="s">&quot;https://api.atargrowth.com/offers&quot;</span><span class="p">).</span><span class="na">buildUpon</span><span class="p">()</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">    </span><span class="p">.</span><span class="na">appendQueryParameter</span><span class="p">(</span><span class="s">&quot;aK&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;your</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="s">    .appendQueryParameter(&quot;</span><span class="n">bId</span><span class="s">&quot;, context.getPackageName())</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="s">    .appendQueryParameter(&quot;</span><span class="n">aV</span><span class="s">&quot;, context.getPackageManager().getPackageInfo(context.getPackageName(), 0).versionName)</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="s">    .appendQueryParameter(&quot;</span><span class="n">os</span><span class="s">&quot;, &quot;</span><span class="n">android</span><span class="s">&quot;)</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="s">    .appendQueryParameter(&quot;</span><span class="n">platform</span><span class="s">&quot;, &quot;</span><span class="n">phone</span><span class="s">&quot;)</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="s">    .appendQueryParameter(&quot;</span><span class="n">userId</span><span class="s">&quot;, &quot;</span><span class="n">userId1234</span><span class="s">&quot;)</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="s">    .appendQueryParameter(&quot;</span><span class="n">referenceId</span><span class="s">&quot;, &quot;</span><span class="mi">12345</span><span class="s">&quot;)</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="s">    .appendQueryParameter(&quot;</span><span class="n">event</span><span class="s">&quot;, &quot;</span><span class="n">purchase</span><span class="s">&quot;);</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="s">String url = builder.build().toString();</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="s">System.out.println(url);</span>
</span></code></pre></div>
</div>
</div>
</div>
<h3 id="full-parameter-list-with-explanation">Full parameter list with explanation</h3>
<p>The more information that you provide, the more relevant we can tailor the offers to your users. Here is a full list of parameters that you can include in the URL:</p>
<table>
<thead>
<tr>
<th>Req.</th>
<th>Field name</th>
<th>Description</th>
<th>Data type</th>
</tr>
</thead>
<tbody>
<tr>
<td>Req</td>
<td>event</td>
<td>User event that preceded the offers</td>
<td>string</td>
</tr>
<tr>
<td>Req</td>
<td>referenceId</td>
<td>Some ID for reference for deduplication.</td>
<td>string</td>
</tr>
<tr>
<td>Req</td>
<td>userId</td>
<td>Some ID for the user.</td>
<td>string</td>
</tr>
<tr>
<td>Rec</td>
<td>email</td>
<td>User email.</td>
<td>string</td>
</tr>
<tr>
<td>Rec</td>
<td>phone</td>
<td>User phone number.</td>
<td>string</td>
</tr>
<tr>
<td>Rec</td>
<td>gender</td>
<td>User gender: M/F</td>
<td>string</td>
</tr>
<tr>
<td>Rec</td>
<td>dob</td>
<td>Date of birth, YYYYMMDD</td>
<td>string</td>
</tr>
<tr>
<td>Rec</td>
<td>firstName</td>
<td>User first name</td>
<td>string</td>
</tr>
<tr>
<td>Rec</td>
<td>lastName</td>
<td>User last name</td>
<td>string</td>
</tr>
<tr>
<td>Opt</td>
<td>amount</td>
<td>Transaction amount</td>
<td>string</td>
</tr>
<tr>
<td>Opt</td>
<td>quantity</td>
<td>Quantity of items purchased</td>
<td>int</td>
</tr>
<tr>
<td>Opt</td>
<td>paymentType</td>
<td>credit, PayPal, or other</td>
<td>string</td>
</tr>
<tr>
<td>Opt</td>
<td>address1</td>
<td>Street address line 1</td>
<td>string</td>
</tr>
<tr>
<td>Opt</td>
<td>address2</td>
<td>Street address line 2</td>
<td>string</td>
</tr>
<tr>
<td>Opt</td>
<td>city</td>
<td>City</td>
<td>string</td>
</tr>
<tr>
<td>Opt</td>
<td>state</td>
<td>State</td>
<td>string</td>
</tr>
<tr>
<td>Opt</td>
<td>country</td>
<td>Country</td>
<td>string</td>
</tr>
</tbody>
</table>
<h2 id="step-3-handle-click-or-cancel-callbacks-from-the-webview">Step 3: Handle click or cancel callbacks from the webview</h2>
<p>When the user interacts with the offer, the webview will send a message to the app. You can handle these messages by listening for specific callback events in the webview.</p>
<h3 id="ios-callbacks">iOS Callbacks</h3>
<p>The way it works is:
1. You register your webview with a script message handler of a specific label
2. You implement the delegate method to handle the message</p>
<h4 id="step-3a-declare-your-webview-delegate">Step 3.a. Declare your webview delegate</h4>
<p>In this example, we're using the <code>WKScriptMessageHandler</code> protocol to handle the messages from the webview, and the webview is initialized inside the <code>WebViewController</code>.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">Swift</label><label for="__tabbed_2_2">Objective C</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-swift highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kd">class</span> <span class="nc">WebViewController</span><span class="p">:</span> <span class="bp">UIViewController</span><span class="p">,</span> <span class="bp">WKScriptMessageHandler</span> <span class="p">{</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-objc highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">@interface</span> <span class="nc">WebViewController</span> : <span class="bp">UIViewController</span><span class="w"> </span><span class="o">&lt;</span><span class="bp">WKScriptMessageHandler</span><span class="o">&gt;</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="step-3b-register-the-script-message-handler">Step 3.b. Register the script message handler</h4>
<p>The script message handler is registered with a specific label that the webview will use to send messages to the app. We use a poorly named label <code>cb</code> in our JS.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">Swift</label><label for="__tabbed_3_2">Objective C</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-swift highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">webView</span><span class="p">.</span><span class="n">configuration</span><span class="p">.</span><span class="n">userContentController</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="kc">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="s">&quot;cb&quot;</span><span class="p">)</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-objc highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">webView</span><span class="p">.</span><span class="n">configuration</span><span class="p">.</span><span class="n">userContentController</span><span class="w"> </span><span class="n">addScriptMessageHandler</span><span class="o">:</span><span class="nb">self</span><span class="w"> </span><span class="n">name</span><span class="o">:</span><span class="s">@&quot;cb&quot;</span><span class="p">];</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="step-3c-implement-the-delegate-method">Step 3.c. Implement the delegate method</h4>
<p>The delegate method <code>userContentController(_:didReceive:)</code> is called when the webview sends a message to the app. This example will show you how to load the URL in the main browser once received.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">Swift</label><label for="__tabbed_4_2">Objective C</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-swift highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="kd">func</span> <span class="nf">userContentController</span><span class="p">(</span><span class="kc">_</span> <span class="n">userContentController</span><span class="p">:</span> <span class="bp">WKUserContentController</span><span class="p">,</span> <span class="n">didReceive</span> <span class="n">message</span><span class="p">:</span> <span class="bp">WKScriptMessage</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>    <span class="k">if</span> <span class="n">message</span><span class="p">.</span><span class="n">name</span> <span class="p">==</span> <span class="s">&quot;cb&quot;</span> <span class="p">{</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>        <span class="k">if</span> <span class="kd">let</span> <span class="nv">jsonString</span> <span class="p">=</span> <span class="n">message</span><span class="p">.</span><span class="n">body</span> <span class="k">as</span><span class="p">?</span> <span class="nb">String</span><span class="p">,</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>           <span class="kd">let</span> <span class="nv">jsonData</span> <span class="p">=</span> <span class="n">jsonString</span><span class="p">.</span><span class="n">data</span><span class="p">(</span><span class="n">using</span><span class="p">:</span> <span class="p">.</span><span class="n">utf8</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>            <span class="k">do</span> <span class="p">{</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>                <span class="kd">let</span> <span class="nv">clickObj</span> <span class="p">=</span> <span class="k">try</span> <span class="n">JSONSerialization</span><span class="p">.</span><span class="n">jsonObject</span><span class="p">(</span><span class="n">with</span><span class="p">:</span> <span class="n">jsonData</span><span class="p">)</span> <span class="k">as</span><span class="p">?</span> <span class="p">[</span><span class="nb">String</span><span class="p">:</span> <span class="nb">String</span><span class="p">]</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>                <span class="k">if</span> <span class="kd">let</span> <span class="nv">clickObj</span> <span class="p">=</span> <span class="n">clickObj</span> <span class="p">{</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>                    <span class="bp">UIApplication</span><span class="p">.</span><span class="n">shared</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">URL</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="n">clickObj</span><span class="p">[</span><span class="s">&quot;clickUrl&quot;</span><span class="p">]</span><span class="o">!</span><span class="p">)</span><span class="o">!</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="p">[:],</span> <span class="n">completionHandler</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>                <span class="p">}</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>            <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>                <span class="c1">// This catch will handle when offers are not present, or any other errors</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>                <span class="n">cancelAndDismiss</span><span class="p">();</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>            <span class="p">}</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>        <span class="p">}</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>    <span class="p">}</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>    <span class="c1">// If reached this point, dismiss the webview</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>    <span class="n">dismiss</span><span class="p">()</span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="p">}</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-objc highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">userContentController:</span><span class="p">(</span><span class="bp">WKUserContentController</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nv">userContentController</span><span class="w"> </span><span class="nf">didReceiveScriptMessage:</span><span class="p">(</span><span class="bp">WKScriptMessage</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nv">message</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">([</span><span class="n">message</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="n">isEqualToString</span><span class="o">:</span><span class="s">@&quot;cb&quot;</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">        </span><span class="c1">// Attempt to parse the JSON string into a dictionary</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">        </span><span class="bp">NSError</span><span class="w"> </span><span class="o">*</span><span class="n">error</span><span class="p">;</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">        </span><span class="bp">NSDictionary</span><span class="w"> </span><span class="o">*</span><span class="n">clickObj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="bp">NSJSONSerialization</span><span class="w"> </span><span class="n">JSONObjectWithData</span><span class="o">:</span><span class="p">[</span><span class="n">message</span><span class="p">.</span><span class="n">body</span><span class="w"> </span><span class="n">dataUsingEncoding</span><span class="o">:</span><span class="n">NSUTF8StringEncoding</span><span class="p">]</span><span class="w"> </span><span class="n">options</span><span class="o">:</span><span class="mi">0</span><span class="w"> </span><span class="n">error</span><span class="o">:&amp;</span><span class="n">error</span><span class="p">];</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">            </span><span class="c1">// This catch will handle when offers are not present, or any other errors</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">            </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">cancelAndDismiss</span><span class="p">];</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">            </span><span class="p">[[</span><span class="bp">UIApplication</span><span class="w"> </span><span class="n">sharedApplication</span><span class="p">]</span><span class="w"> </span><span class="n">openURL</span><span class="o">:</span><span class="p">[</span><span class="bp">NSURL</span><span class="w"> </span><span class="n">URLWithString</span><span class="o">:</span><span class="n">clickObj</span><span class="p">[</span><span class="s">@&quot;clickUrl&quot;</span><span class="p">]]</span><span class="w"> </span><span class="n">options</span><span class="o">:</span><span class="l">@{}</span><span class="w"> </span><span class="n">completionHandler</span><span class="o">:</span><span class="nb">nil</span><span class="p">];</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="w">    </span><span class="c1">// If reached this point, dismiss the webview</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">dismiss</span><span class="p">];</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h3 id="android-callbacks">Android Callbacks</h3>
<p>Similar to iOS, the way Android works is to register the Javascript handler on your webview with a specific label, and then handle the message in the app.</p>
<h4 id="step-3a-register-the-javascript-interface-and-implement-handling">Step 3.a. Register the Javascript interface and implement handling</h4>
<p>In this example, we're using the <code>addJavascriptInterface</code> method to register the Javascript interface with the webview. The Javascript interface is a class that has methods that can be called from the webview.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:2"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><input id="__tabbed_5_2" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="__tabbed_5_1">Java</label><label for="__tabbed_5_2">Kotlin</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-java highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">webView</span><span class="p">.</span><span class="na">getSettings</span><span class="p">().</span><span class="na">setJavaScriptEnabled</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="n">webView</span><span class="p">.</span><span class="na">addJavascriptInterface</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">    </span><span class="nd">@JavascriptInterface</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">postMessage</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w">        </span><span class="n">JSONObject</span><span class="w"> </span><span class="n">messageData</span><span class="p">;</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">            </span><span class="n">messageData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JSONObject</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="w">            </span><span class="c1">// This should never happen, but just in case, handle parsing errors here</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="w">            </span><span class="n">cancelAndDismiss</span><span class="p">();</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="w">            </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">clickUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">messageData</span><span class="p">.</span><span class="na">optString</span><span class="p">(</span><span class="s">&quot;clickUrl&quot;</span><span class="p">);</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">clickUrl</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">clickUrl</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a><span class="w">                </span><span class="n">Intent</span><span class="w"> </span><span class="n">browserIntent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Intent</span><span class="p">(</span><span class="n">Intent</span><span class="p">.</span><span class="na">ACTION_VIEW</span><span class="p">,</span><span class="w"> </span><span class="n">Uri</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="n">clickUrl</span><span class="p">));</span>
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a><span class="w">                </span><span class="n">browserIntent</span><span class="p">.</span><span class="na">addFlags</span><span class="p">(</span><span class="n">Intent</span><span class="p">.</span><span class="na">FLAG_ACTIVITY_NEW_TASK</span><span class="p">);</span>
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a><span class="w">                </span><span class="n">getContext</span><span class="p">().</span><span class="na">startActivity</span><span class="p">(</span><span class="n">browserIntent</span><span class="p">);</span>
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-22"><a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a><span class="w">                </span><span class="c1">// This will trigger in case there are no offers available for whatever reason</span>
</span><span id="__span-11-23"><a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a><span class="w">                </span><span class="n">cancelAndDismiss</span><span class="p">();</span>
</span><span id="__span-11-24"><a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a><span class="w">                </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-11-25"><a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-11-26"><a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-11-27"><a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a>
</span><span id="__span-11-28"><a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a><span class="w">        </span><span class="c1">// Dismiss the webview</span>
</span><span id="__span-11-29"><a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a><span class="w">        </span><span class="n">dismiss</span><span class="p">()</span>
</span><span id="__span-11-30"><a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-11-31"><a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a><span class="p">},</span><span class="w"> </span><span class="s">&quot;AtarInterface&quot;</span><span class="p">);</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">webView</span><span class="p">.</span><span class="na">settings</span><span class="p">.</span><span class="na">javaScriptEnabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="n">webView</span><span class="p">.</span><span class="na">addJavascriptInterface</span><span class="p">(</span><span class="kd">object</span><span class="w"> </span><span class="err">{</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">    </span><span class="nd">@JavascriptInterface</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">postMessage</span><span class="p">(</span><span class="n">data</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">messageData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w">            </span><span class="n">JSONObject</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">Exception</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="w">            </span><span class="c1">// This should never happen, but just in case, handle parsing errors here</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="w">            </span><span class="n">cancelAndDismiss</span><span class="p">()</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="w">            </span><span class="k">return</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">clickUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">messageData</span><span class="p">.</span><span class="na">optString</span><span class="p">(</span><span class="s">&quot;clickUrl&quot;</span><span class="p">)</span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">clickUrl</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">clickUrl</span><span class="p">.</span><span class="na">isNotEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a><span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">browserIntent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Intent</span><span class="p">(</span><span class="n">Intent</span><span class="p">.</span><span class="na">ACTION_VIEW</span><span class="p">,</span><span class="w"> </span><span class="n">Uri</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="n">clickUrl</span><span class="p">))</span>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a><span class="w">                </span><span class="n">browserIntent</span><span class="p">.</span><span class="na">addFlags</span><span class="p">(</span><span class="n">Intent</span><span class="p">.</span><span class="na">FLAG_ACTIVITY_NEW_TASK</span><span class="p">)</span>
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a><span class="w">                </span><span class="n">context</span><span class="p">.</span><span class="na">startActivity</span><span class="p">(</span><span class="n">browserIntent</span><span class="p">)</span>
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">Exception</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a><span class="w">                </span><span class="c1">// This will trigger in case there are no offers available for whatever reason</span>
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a><span class="w">                </span><span class="n">cancelAndDismiss</span><span class="p">()</span>
</span><span id="__span-12-23"><a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a><span class="w">                </span><span class="k">return</span>
</span><span id="__span-12-24"><a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-12-25"><a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-12-26"><a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a>
</span><span id="__span-12-27"><a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a><span class="w">        </span><span class="c1">// Dismiss the webview</span>
</span><span id="__span-12-28"><a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a><span class="w">        </span><span class="n">dismiss</span><span class="p">()</span>
</span><span id="__span-12-29"><a id="__codelineno-12-29" name="__codelineno-12-29" href="#__codelineno-12-29"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-12-30"><a id="__codelineno-12-30" name="__codelineno-12-30" href="#__codelineno-12-30"></a><span class="p">},</span><span class="w"> </span><span class="s">&quot;AtarInterface&quot;</span><span class="p">)</span>
</span></code></pre></div>
</div>
</div>
</div>
<h2 id="step-4-implement-your-custom-cancel-button">Step 4: Implement your custom cancel button</h2>
<p>In the event that the user wants to hide the interstitial, you should provide a way for them to do so. This can be a simple button that dismisses the webview. Here's an example of how you can implement a cancel button in your app.</p>
<h3 id="ios-cancel-button">iOS Cancel Button</h3>
<p>In this example, we use a UIButton with an X label that will dismiss the webview when clicked.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:2"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><input id="__tabbed_6_2" name="__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="__tabbed_6_1">Swift</label><label for="__tabbed_6_2">Objective C</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-swift highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="kd">let</span> <span class="nv">cancelButton</span> <span class="p">=</span> <span class="bp">UIButton</span><span class="p">()</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="n">cancelButton</span><span class="p">.</span><span class="n">translatesAutoresizingMaskIntoConstraints</span> <span class="p">=</span> <span class="kc">false</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="n">cancelButton</span><span class="p">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="k">for</span><span class="p">:</span> <span class="p">.</span><span class="n">normal</span><span class="p">)</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="n">cancelButton</span><span class="p">.</span><span class="n">titleLabel</span><span class="p">?.</span><span class="n">font</span> <span class="p">=</span> <span class="bp">UIFont</span><span class="p">.</span><span class="n">monospacedSystemFont</span><span class="p">(</span><span class="n">ofSize</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="p">.</span><span class="n">regular</span><span class="p">)</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="n">cancelButton</span><span class="p">.</span><span class="n">setTitleColor</span><span class="p">(.</span><span class="n">gray</span><span class="p">,</span> <span class="k">for</span><span class="p">:</span> <span class="p">.</span><span class="n">normal</span><span class="p">)</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="n">cancelButton</span><span class="p">.</span><span class="n">addTarget</span><span class="p">(</span><span class="kc">self</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="k">#selector</span><span class="p">(</span><span class="n">cancelAndDismiss</span><span class="p">),</span> <span class="k">for</span><span class="p">:</span> <span class="p">.</span><span class="n">touchUpInside</span><span class="p">)</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="c1">// Make sure to add this last, so it appears on top</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="n">addSubview</span><span class="p">(</span><span class="n">cancelButton</span><span class="p">)</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="n">cancelButton</span><span class="p">.</span><span class="n">topAnchor</span><span class="p">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">equalTo</span><span class="p">:</span> <span class="n">yourContentView</span><span class="p">.</span><span class="n">topAnchor</span><span class="p">,</span> <span class="n">constant</span><span class="p">:</span> <span class="mi">8</span><span class="p">),</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="n">cancelButton</span><span class="p">.</span><span class="n">trailingAnchor</span><span class="p">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">equalTo</span><span class="p">:</span> <span class="n">yourContentView</span><span class="p">.</span><span class="n">trailingAnchor</span><span class="p">,</span> <span class="n">constant</span><span class="p">:</span> <span class="o">-</span><span class="mi">8</span><span class="p">),</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="n">cancelButton</span><span class="p">.</span><span class="n">widthAnchor</span><span class="p">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">equalToConstant</span><span class="p">:</span> <span class="mi">30</span><span class="p">),</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a><span class="n">cancelButton</span><span class="p">.</span><span class="n">heightAnchor</span><span class="p">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">equalToConstant</span><span class="p">:</span> <span class="mi">30</span><span class="p">)</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-objc highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="bp">UIButton</span><span class="w"> </span><span class="o">*</span><span class="n">cancelButton</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="bp">UIButton</span><span class="w"> </span><span class="n">buttonWithType</span><span class="o">:</span><span class="n">UIButtonTypeCustom</span><span class="p">];</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="n">cancelButton</span><span class="p">.</span><span class="n">translatesAutoresizingMaskIntoConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NO</span><span class="p">;</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="p">[</span><span class="n">cancelButton</span><span class="w"> </span><span class="n">setTitle</span><span class="o">:</span><span class="s">@&quot;x&quot;</span><span class="w"> </span><span class="n">forState</span><span class="o">:</span><span class="n">UIControlStateNormal</span><span class="p">];</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="n">cancelButton</span><span class="p">.</span><span class="n">titleLabel</span><span class="p">.</span><span class="n">font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="bp">UIFont</span><span class="w"> </span><span class="n">monospacedSystemFontOfSize</span><span class="o">:</span><span class="mi">20</span><span class="w"> </span><span class="n">weight</span><span class="o">:</span><span class="n">UIFontWeightRegular</span><span class="p">];</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="p">[</span><span class="n">cancelButton</span><span class="w"> </span><span class="n">setTitleColor</span><span class="o">:</span><span class="bp">UIColor</span><span class="p">.</span><span class="n">grayColor</span><span class="w"> </span><span class="n">forState</span><span class="o">:</span><span class="n">UIControlStateNormal</span><span class="p">];</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="p">[</span><span class="n">cancelButton</span><span class="w"> </span><span class="n">addTarget</span><span class="o">:</span><span class="nb">self</span><span class="w"> </span><span class="n">action</span><span class="o">:</span><span class="k">@selector</span><span class="p">(</span><span class="n">cancelAndDismiss</span><span class="p">)</span><span class="w"> </span><span class="n">forControlEvents</span><span class="o">:</span><span class="n">UIControlEventTouchUpInside</span><span class="p">];</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="c1">// Make sure to add this last, so it appears on top</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span><span class="w"> </span><span class="n">addSubview</span><span class="o">:</span><span class="n">cancelButton</span><span class="p">];</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="p">[</span><span class="n">cancelButton</span><span class="p">.</span><span class="n">topAnchor</span><span class="w"> </span><span class="n">constraintEqualToAnchor</span><span class="o">:</span><span class="n">yourContentView</span><span class="p">.</span><span class="n">topAnchor</span><span class="w"> </span><span class="n">constant</span><span class="o">:</span><span class="mi">8</span><span class="p">].</span><span class="n">active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">YES</span><span class="p">;</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="p">[</span><span class="n">cancelButton</span><span class="p">.</span><span class="n">trailingAnchor</span><span class="w"> </span><span class="n">constraintEqualToAnchor</span><span class="o">:</span><span class="n">yourContentView</span><span class="p">.</span><span class="n">trailingAnchor</span><span class="w"> </span><span class="n">constant</span><span class="o">:</span><span class="mi">-8</span><span class="p">].</span><span class="n">active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">YES</span><span class="p">;</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="p">[</span><span class="n">cancelButton</span><span class="p">.</span><span class="n">widthAnchor</span><span class="w"> </span><span class="n">constraintEqualToConstant</span><span class="o">:</span><span class="mi">30</span><span class="p">].</span><span class="n">active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">YES</span><span class="p">;</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="p">[</span><span class="n">cancelButton</span><span class="p">.</span><span class="n">heightAnchor</span><span class="w"> </span><span class="n">constraintEqualToConstant</span><span class="o">:</span><span class="mi">30</span><span class="p">].</span><span class="n">active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">YES</span><span class="p">;</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="android-cancel-button">Android Cancel Button</h4>
<p>In this example, we use a Button with an X label that will dismiss the webview when clicked.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="7:2"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><input id="__tabbed_7_2" name="__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="__tabbed_7_1">Java</label><label for="__tabbed_7_2">Kotlin</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-java highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="n">Button</span><span class="w"> </span><span class="n">closeButton</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Button</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="n">closeButton</span><span class="p">.</span><span class="na">setText</span><span class="p">(</span><span class="s">&quot;X&quot;</span><span class="p">);</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="n">closeButton</span><span class="p">.</span><span class="na">setTextColor</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="na">BLACK</span><span class="p">);</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="n">closeButton</span><span class="p">.</span><span class="na">setBackground</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="kt">int</span><span class="w"> </span><span class="n">buttonSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="mi">25</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">getResources</span><span class="p">().</span><span class="na">getDisplayMetrics</span><span class="p">().</span><span class="na">density</span><span class="p">);</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="n">LayoutParams</span><span class="w"> </span><span class="n">closeButtonParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LayoutParams</span><span class="p">(</span><span class="n">buttonSize</span><span class="p">,</span><span class="w"> </span><span class="n">buttonSize</span><span class="p">);</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="n">closeButtonParams</span><span class="p">.</span><span class="na">gravity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Gravity</span><span class="p">.</span><span class="na">TOP</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Gravity</span><span class="p">.</span><span class="na">END</span><span class="p">;</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="n">closeButton</span><span class="p">.</span><span class="na">setLayoutParams</span><span class="p">(</span><span class="n">closeButtonParams</span><span class="p">);</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="n">closeButton</span><span class="p">.</span><span class="na">setPadding</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span><span class="w"> </span><span class="c1">// Padding in pixels</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="n">closeButton</span><span class="p">.</span><span class="na">setOnClickListener</span><span class="p">(</span><span class="n">v</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">cancelAndDismiss</span><span class="p">());</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="n">yourContentView</span><span class="p">.</span><span class="na">addView</span><span class="p">(</span><span class="n">closeButton</span><span class="p">);</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="kd">val</span><span class="w"> </span><span class="nv">closeButton</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Button</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="n">closeButton</span><span class="p">.</span><span class="na">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;X&quot;</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="n">closeButton</span><span class="p">.</span><span class="na">setTextColor</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="na">BLACK</span><span class="p">)</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="n">closeButton</span><span class="p">.</span><span class="na">background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="kd">val</span><span class="w"> </span><span class="nv">buttonSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="m">25</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">resources</span><span class="p">.</span><span class="na">displayMetrics</span><span class="p">.</span><span class="na">density</span><span class="p">).</span><span class="na">toInt</span><span class="p">()</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="kd">val</span><span class="w"> </span><span class="nv">closeButtonParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LayoutParams</span><span class="p">(</span><span class="n">buttonSize</span><span class="p">,</span><span class="w"> </span><span class="n">buttonSize</span><span class="p">)</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="n">closeButtonParams</span><span class="p">.</span><span class="na">gravity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Gravity</span><span class="p">.</span><span class="na">TOP</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">Gravity</span><span class="p">.</span><span class="na">END</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="n">closeButton</span><span class="p">.</span><span class="na">layoutParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">closeButtonParams</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="n">closeButton</span><span class="p">.</span><span class="na">setPadding</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="c1">// Padding in pixels</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="n">closeButton</span><span class="p">.</span><span class="na">setOnClickListener</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">cancelAndDismiss</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="n">yourContentView</span><span class="p">.</span><span class="na">addView</span><span class="p">(</span><span class="n">closeButton</span><span class="p">)</span>
</span></code></pre></div>
</div>
</div>
</div>
<h2 id="appendix-full-example-webview-interstitial-presentation">Appendix: Full example webview interstitial presentation</h2>
<p>Below is a full example of how to create a popup interstital in iOS and Android. At a high level, this implementation will create a an Interstital view class that will insert the webview frame on whatever window or Activity is currently present at the top. The webview has some rounded corners and a close button that will dismiss the webview.</p>
<p>The webview sits on top of the current view, and is styled as follows:</p>
<ul>
<li>Width: 90% of the screen width</li>
<li>Height: 80% of the screen height</li>
<li>Has an activity indicator in the center of the screen while loading the URL</li>
<li>Gray, translucent background surrounding the offer itself</li>
<li>Animates in and out from the top of the screen</li>
</ul>
<h3 id="ios-interstitial-view-example">iOS Interstitial View Example</h3>
<h4 id="using-the-below-ios-interstitial">Using the below iOS interstitial</h4>
<p>To use the below iOS interstitial, you can create an instance of the <code>InterstitialView</code> class, configure it with the URL you want to load, and then present it on the screen. As mentioned in the code, we recommend that you separate the initialization of the webview from the actual loading of the URL and presentation. This is because iOS has some multi-second initialization latency with the webview sometimes.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="8:2"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio" /><input id="__tabbed_8_2" name="__tabbed_8" type="radio" /><div class="tabbed-labels"><label for="__tabbed_8_1">Swift</label><label for="__tabbed_8_2">Objective C</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-swift highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="kd">let</span> <span class="nv">interstitialView</span> <span class="p">=</span> <span class="n">InterstitialView</span><span class="p">()</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="n">interstitialView</span><span class="p">.</span><span class="n">configure</span><span class="p">(</span><span class="n">withUrl</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="n">interstitialView</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-objc highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">InterstitialView</span><span class="w"> </span><span class="o">*</span><span class="n">interstitialView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="n">InterstitialView</span><span class="w"> </span><span class="n">alloc</span><span class="p">]</span><span class="w"> </span><span class="n">initWithFrame</span><span class="o">:</span><span class="n">CGRectZero</span><span class="p">];</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="p">[</span><span class="n">interstitialView</span><span class="w"> </span><span class="n">configureWithUrl</span><span class="o">:</span><span class="n">url</span><span class="p">];</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="p">[</span><span class="n">interstitialView</span><span class="w"> </span><span class="n">show</span><span class="p">];</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="webview-interstitial-view-in-ios">Webview interstitial view in iOS</h4>
<div class="tabbed-set tabbed-alternate" data-tabs="9:2"><input checked="checked" id="__tabbed_9_1" name="__tabbed_9" type="radio" /><input id="__tabbed_9_2" name="__tabbed_9" type="radio" /><div class="tabbed-labels"><label for="__tabbed_9_1">Swift</label><label for="__tabbed_9_2">Objective C</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-swift highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="kd">class</span> <span class="nc">InterstitialView</span><span class="p">:</span> <span class="bp">UIView</span><span class="p">,</span> <span class="bp">WKNavigationDelegate</span><span class="p">,</span> <span class="bp">WKScriptMessageHandler</span> <span class="p">{</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>    <span class="kd">private</span> <span class="kd">let</span> <span class="nv">contentView</span> <span class="p">=</span> <span class="bp">UIView</span><span class="p">()</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>    <span class="kd">private</span> <span class="kd">let</span> <span class="nv">webView</span><span class="p">:</span> <span class="bp">WKWebView</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>    <span class="kd">private</span> <span class="kd">let</span> <span class="nv">activityIndicator</span> <span class="p">=</span> <span class="bp">UIActivityIndicatorView</span><span class="p">(</span><span class="n">style</span><span class="p">:</span> <span class="p">.</span><span class="n">large</span><span class="p">)</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>    <span class="kd">private</span> <span class="kd">let</span> <span class="nv">closeButton</span> <span class="p">=</span> <span class="bp">UIButton</span><span class="p">()</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>    <span class="kd">private</span> <span class="kd">var</span> <span class="nv">lastOfferRequest</span><span class="p">:</span> <span class="n">OfferRequest</span><span class="p">?</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>    <span class="c1">// WKWebView has multi-second initialization issues sometimes, </span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>    <span class="c1">// so we separate the initialization of the webview from the actual </span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>    <span class="c1">// loading of the URL and presentation.</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>    <span class="kr">override</span> <span class="kd">init</span><span class="p">(</span><span class="n">frame</span><span class="p">:</span> <span class="n">CGRect</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a>        <span class="kd">let</span> <span class="nv">config</span> <span class="p">=</span> <span class="bp">WKWebViewConfiguration</span><span class="p">()</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a>        <span class="kc">self</span><span class="p">.</span><span class="n">webView</span> <span class="p">=</span> <span class="bp">WKWebView</span><span class="p">(</span><span class="n">frame</span><span class="p">:</span> <span class="p">.</span><span class="n">zero</span><span class="p">,</span> <span class="n">configuration</span><span class="p">:</span> <span class="n">config</span><span class="p">)</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a>        <span class="kc">self</span><span class="p">.</span><span class="n">webView</span><span class="p">.</span><span class="n">loadHTMLString</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">baseURL</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a>        <span class="kc">super</span><span class="p">.</span><span class="kd">init</span><span class="p">(</span><span class="n">frame</span><span class="p">:</span> <span class="n">frame</span><span class="p">)</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a>
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a>        <span class="kd">let</span> <span class="nv">contentController</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">webView</span><span class="p">.</span><span class="n">configuration</span><span class="p">.</span><span class="n">userContentController</span>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a>        <span class="n">contentController</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="kc">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="s">&quot;cb&quot;</span><span class="p">)</span>
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a>
</span><span id="__span-19-21"><a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a>        <span class="n">setupViews</span><span class="p">()</span>
</span><span id="__span-19-22"><a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a>    <span class="p">}</span>
</span><span id="__span-19-23"><a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a>
</span><span id="__span-19-24"><a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a>    <span class="kr">required</span> <span class="kd">init</span><span class="p">?(</span><span class="n">coder</span><span class="p">:</span> <span class="bp">NSCoder</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-19-25"><a id="__codelineno-19-25" name="__codelineno-19-25" href="#__codelineno-19-25"></a>        <span class="bp">fatalError</span><span class="p">(</span><span class="s">&quot;init(coder:) has not been implemented&quot;</span><span class="p">)</span>
</span><span id="__span-19-26"><a id="__codelineno-19-26" name="__codelineno-19-26" href="#__codelineno-19-26"></a>    <span class="p">}</span>
</span><span id="__span-19-27"><a id="__codelineno-19-27" name="__codelineno-19-27" href="#__codelineno-19-27"></a>
</span><span id="__span-19-28"><a id="__codelineno-19-28" name="__codelineno-19-28" href="#__codelineno-19-28"></a>    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">setupViews</span><span class="p">()</span> <span class="p">{</span>
</span><span id="__span-19-29"><a id="__codelineno-19-29" name="__codelineno-19-29" href="#__codelineno-19-29"></a>        <span class="n">backgroundColor</span> <span class="p">=</span> <span class="bp">UIColor</span><span class="p">.</span><span class="n">black</span><span class="p">.</span><span class="n">withAlphaComponent</span><span class="p">(</span><span class="mf">0.6</span><span class="p">)</span>
</span><span id="__span-19-30"><a id="__codelineno-19-30" name="__codelineno-19-30" href="#__codelineno-19-30"></a>
</span><span id="__span-19-31"><a id="__codelineno-19-31" name="__codelineno-19-31" href="#__codelineno-19-31"></a>        <span class="c1">// Content view configuration</span>
</span><span id="__span-19-32"><a id="__codelineno-19-32" name="__codelineno-19-32" href="#__codelineno-19-32"></a>        <span class="n">contentView</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="p">=</span> <span class="p">.</span><span class="n">white</span>
</span><span id="__span-19-33"><a id="__codelineno-19-33" name="__codelineno-19-33" href="#__codelineno-19-33"></a>        <span class="n">contentView</span><span class="p">.</span><span class="n">layer</span><span class="p">.</span><span class="n">cornerRadius</span> <span class="p">=</span> <span class="mf">12.0</span>
</span><span id="__span-19-34"><a id="__codelineno-19-34" name="__codelineno-19-34" href="#__codelineno-19-34"></a>        <span class="n">contentView</span><span class="p">.</span><span class="n">clipsToBounds</span> <span class="p">=</span> <span class="kc">true</span>
</span><span id="__span-19-35"><a id="__codelineno-19-35" name="__codelineno-19-35" href="#__codelineno-19-35"></a>        <span class="n">contentView</span><span class="p">.</span><span class="n">translatesAutoresizingMaskIntoConstraints</span> <span class="p">=</span> <span class="kc">false</span>
</span><span id="__span-19-36"><a id="__codelineno-19-36" name="__codelineno-19-36" href="#__codelineno-19-36"></a>        <span class="n">addSubview</span><span class="p">(</span><span class="n">contentView</span><span class="p">)</span>
</span><span id="__span-19-37"><a id="__codelineno-19-37" name="__codelineno-19-37" href="#__codelineno-19-37"></a>
</span><span id="__span-19-38"><a id="__codelineno-19-38" name="__codelineno-19-38" href="#__codelineno-19-38"></a>        <span class="n">webView</span><span class="p">.</span><span class="n">translatesAutoresizingMaskIntoConstraints</span> <span class="p">=</span> <span class="kc">false</span>
</span><span id="__span-19-39"><a id="__codelineno-19-39" name="__codelineno-19-39" href="#__codelineno-19-39"></a>        <span class="n">webView</span><span class="p">.</span><span class="n">scrollView</span><span class="p">.</span><span class="n">contentInset</span> <span class="p">=</span> <span class="n">UIEdgeInsets</span><span class="p">.</span><span class="n">zero</span>
</span><span id="__span-19-40"><a id="__codelineno-19-40" name="__codelineno-19-40" href="#__codelineno-19-40"></a>        <span class="n">webView</span><span class="p">.</span><span class="n">scrollView</span><span class="p">.</span><span class="n">bounces</span> <span class="p">=</span> <span class="kc">false</span>
</span><span id="__span-19-41"><a id="__codelineno-19-41" name="__codelineno-19-41" href="#__codelineno-19-41"></a>        <span class="n">webView</span><span class="p">.</span><span class="n">navigationDelegate</span> <span class="p">=</span> <span class="kc">self</span>
</span><span id="__span-19-42"><a id="__codelineno-19-42" name="__codelineno-19-42" href="#__codelineno-19-42"></a>        <span class="n">contentView</span><span class="p">.</span><span class="n">addSubview</span><span class="p">(</span><span class="n">webView</span><span class="p">)</span>
</span><span id="__span-19-43"><a id="__codelineno-19-43" name="__codelineno-19-43" href="#__codelineno-19-43"></a>
</span><span id="__span-19-44"><a id="__codelineno-19-44" name="__codelineno-19-44" href="#__codelineno-19-44"></a>        <span class="c1">// Activity Indicator configuration</span>
</span><span id="__span-19-45"><a id="__codelineno-19-45" name="__codelineno-19-45" href="#__codelineno-19-45"></a>        <span class="n">activityIndicator</span><span class="p">.</span><span class="n">translatesAutoresizingMaskIntoConstraints</span> <span class="p">=</span> <span class="kc">false</span>
</span><span id="__span-19-46"><a id="__codelineno-19-46" name="__codelineno-19-46" href="#__codelineno-19-46"></a>        <span class="n">contentView</span><span class="p">.</span><span class="n">addSubview</span><span class="p">(</span><span class="n">activityIndicator</span><span class="p">)</span>
</span><span id="__span-19-47"><a id="__codelineno-19-47" name="__codelineno-19-47" href="#__codelineno-19-47"></a>        <span class="n">activityIndicator</span><span class="p">.</span><span class="n">startAnimating</span><span class="p">()</span>
</span><span id="__span-19-48"><a id="__codelineno-19-48" name="__codelineno-19-48" href="#__codelineno-19-48"></a>
</span><span id="__span-19-49"><a id="__codelineno-19-49" name="__codelineno-19-49" href="#__codelineno-19-49"></a>        <span class="n">closeButton</span><span class="p">.</span><span class="n">translatesAutoresizingMaskIntoConstraints</span> <span class="p">=</span> <span class="kc">false</span>
</span><span id="__span-19-50"><a id="__codelineno-19-50" name="__codelineno-19-50" href="#__codelineno-19-50"></a>        <span class="n">closeButton</span><span class="p">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="k">for</span><span class="p">:</span> <span class="p">.</span><span class="n">normal</span><span class="p">)</span>
</span><span id="__span-19-51"><a id="__codelineno-19-51" name="__codelineno-19-51" href="#__codelineno-19-51"></a>        <span class="n">closeButton</span><span class="p">.</span><span class="n">titleLabel</span><span class="p">?.</span><span class="n">font</span> <span class="p">=</span> <span class="bp">UIFont</span><span class="p">.</span><span class="n">monospacedSystemFont</span><span class="p">(</span><span class="n">ofSize</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="p">.</span><span class="n">regular</span><span class="p">)</span>
</span><span id="__span-19-52"><a id="__codelineno-19-52" name="__codelineno-19-52" href="#__codelineno-19-52"></a>        <span class="n">closeButton</span><span class="p">.</span><span class="n">setTitleColor</span><span class="p">(.</span><span class="n">gray</span><span class="p">,</span> <span class="k">for</span><span class="p">:</span> <span class="p">.</span><span class="n">normal</span><span class="p">)</span>
</span><span id="__span-19-53"><a id="__codelineno-19-53" name="__codelineno-19-53" href="#__codelineno-19-53"></a>        <span class="n">closeButton</span><span class="p">.</span><span class="n">addTarget</span><span class="p">(</span><span class="kc">self</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="k">#selector</span><span class="p">(</span><span class="n">cancelAndDismiss</span><span class="p">),</span> <span class="k">for</span><span class="p">:</span> <span class="p">.</span><span class="n">touchUpInside</span><span class="p">)</span>
</span><span id="__span-19-54"><a id="__codelineno-19-54" name="__codelineno-19-54" href="#__codelineno-19-54"></a>        <span class="n">addSubview</span><span class="p">(</span><span class="n">closeButton</span><span class="p">)</span>
</span><span id="__span-19-55"><a id="__codelineno-19-55" name="__codelineno-19-55" href="#__codelineno-19-55"></a>
</span><span id="__span-19-56"><a id="__codelineno-19-56" name="__codelineno-19-56" href="#__codelineno-19-56"></a>        <span class="n">setupConstraints</span><span class="p">()</span>
</span><span id="__span-19-57"><a id="__codelineno-19-57" name="__codelineno-19-57" href="#__codelineno-19-57"></a>    <span class="p">}</span>
</span><span id="__span-19-58"><a id="__codelineno-19-58" name="__codelineno-19-58" href="#__codelineno-19-58"></a>
</span><span id="__span-19-59"><a id="__codelineno-19-59" name="__codelineno-19-59" href="#__codelineno-19-59"></a>    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">setupConstraints</span><span class="p">()</span> <span class="p">{</span>
</span><span id="__span-19-60"><a id="__codelineno-19-60" name="__codelineno-19-60" href="#__codelineno-19-60"></a>        <span class="bp">NSLayoutConstraint</span><span class="p">.</span><span class="n">activate</span><span class="p">([</span>
</span><span id="__span-19-61"><a id="__codelineno-19-61" name="__codelineno-19-61" href="#__codelineno-19-61"></a>            <span class="n">contentView</span><span class="p">.</span><span class="n">centerYAnchor</span><span class="p">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">equalTo</span><span class="p">:</span> <span class="n">centerYAnchor</span><span class="p">),</span>
</span><span id="__span-19-62"><a id="__codelineno-19-62" name="__codelineno-19-62" href="#__codelineno-19-62"></a>            <span class="n">contentView</span><span class="p">.</span><span class="n">centerXAnchor</span><span class="p">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">equalTo</span><span class="p">:</span> <span class="n">centerXAnchor</span><span class="p">),</span>
</span><span id="__span-19-63"><a id="__codelineno-19-63" name="__codelineno-19-63" href="#__codelineno-19-63"></a>            <span class="n">contentView</span><span class="p">.</span><span class="n">widthAnchor</span><span class="p">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">equalTo</span><span class="p">:</span> <span class="n">widthAnchor</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">),</span>
</span><span id="__span-19-64"><a id="__codelineno-19-64" name="__codelineno-19-64" href="#__codelineno-19-64"></a>            <span class="n">contentView</span><span class="p">.</span><span class="n">heightAnchor</span><span class="p">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">equalTo</span><span class="p">:</span> <span class="n">heightAnchor</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">:</span>  <span class="mf">0.8</span><span class="p">),</span>
</span><span id="__span-19-65"><a id="__codelineno-19-65" name="__codelineno-19-65" href="#__codelineno-19-65"></a>
</span><span id="__span-19-66"><a id="__codelineno-19-66" name="__codelineno-19-66" href="#__codelineno-19-66"></a>            <span class="n">webView</span><span class="p">.</span><span class="n">topAnchor</span><span class="p">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">equalTo</span><span class="p">:</span> <span class="n">contentView</span><span class="p">.</span><span class="n">topAnchor</span><span class="p">),</span>
</span><span id="__span-19-67"><a id="__codelineno-19-67" name="__codelineno-19-67" href="#__codelineno-19-67"></a>            <span class="n">webView</span><span class="p">.</span><span class="n">leftAnchor</span><span class="p">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">equalTo</span><span class="p">:</span> <span class="n">contentView</span><span class="p">.</span><span class="n">leftAnchor</span><span class="p">),</span>
</span><span id="__span-19-68"><a id="__codelineno-19-68" name="__codelineno-19-68" href="#__codelineno-19-68"></a>            <span class="n">webView</span><span class="p">.</span><span class="n">rightAnchor</span><span class="p">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">equalTo</span><span class="p">:</span> <span class="n">contentView</span><span class="p">.</span><span class="n">rightAnchor</span><span class="p">),</span>
</span><span id="__span-19-69"><a id="__codelineno-19-69" name="__codelineno-19-69" href="#__codelineno-19-69"></a>            <span class="n">webView</span><span class="p">.</span><span class="n">bottomAnchor</span><span class="p">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">equalTo</span><span class="p">:</span> <span class="n">contentView</span><span class="p">.</span><span class="n">bottomAnchor</span><span class="p">),</span>
</span><span id="__span-19-70"><a id="__codelineno-19-70" name="__codelineno-19-70" href="#__codelineno-19-70"></a>
</span><span id="__span-19-71"><a id="__codelineno-19-71" name="__codelineno-19-71" href="#__codelineno-19-71"></a>            <span class="n">activityIndicator</span><span class="p">.</span><span class="n">centerXAnchor</span><span class="p">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">equalTo</span><span class="p">:</span> <span class="n">contentView</span><span class="p">.</span><span class="n">centerXAnchor</span><span class="p">),</span>
</span><span id="__span-19-72"><a id="__codelineno-19-72" name="__codelineno-19-72" href="#__codelineno-19-72"></a>            <span class="n">activityIndicator</span><span class="p">.</span><span class="n">centerYAnchor</span><span class="p">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">equalTo</span><span class="p">:</span> <span class="n">contentView</span><span class="p">.</span><span class="n">centerYAnchor</span><span class="p">),</span>
</span><span id="__span-19-73"><a id="__codelineno-19-73" name="__codelineno-19-73" href="#__codelineno-19-73"></a>
</span><span id="__span-19-74"><a id="__codelineno-19-74" name="__codelineno-19-74" href="#__codelineno-19-74"></a>            <span class="n">closeButton</span><span class="p">.</span><span class="n">topAnchor</span><span class="p">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">equalTo</span><span class="p">:</span> <span class="n">contentView</span><span class="p">.</span><span class="n">topAnchor</span><span class="p">,</span> <span class="n">constant</span><span class="p">:</span> <span class="mi">8</span><span class="p">),</span>
</span><span id="__span-19-75"><a id="__codelineno-19-75" name="__codelineno-19-75" href="#__codelineno-19-75"></a>            <span class="n">closeButton</span><span class="p">.</span><span class="n">trailingAnchor</span><span class="p">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">equalTo</span><span class="p">:</span> <span class="n">contentView</span><span class="p">.</span><span class="n">trailingAnchor</span><span class="p">,</span> <span class="n">constant</span><span class="p">:</span> <span class="o">-</span><span class="mi">8</span><span class="p">),</span>
</span><span id="__span-19-76"><a id="__codelineno-19-76" name="__codelineno-19-76" href="#__codelineno-19-76"></a>            <span class="n">closeButton</span><span class="p">.</span><span class="n">widthAnchor</span><span class="p">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">equalToConstant</span><span class="p">:</span> <span class="mi">30</span><span class="p">),</span>
</span><span id="__span-19-77"><a id="__codelineno-19-77" name="__codelineno-19-77" href="#__codelineno-19-77"></a>            <span class="n">closeButton</span><span class="p">.</span><span class="n">heightAnchor</span><span class="p">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">equalToConstant</span><span class="p">:</span> <span class="mi">30</span><span class="p">)</span>
</span><span id="__span-19-78"><a id="__codelineno-19-78" name="__codelineno-19-78" href="#__codelineno-19-78"></a>        <span class="p">])</span>
</span><span id="__span-19-79"><a id="__codelineno-19-79" name="__codelineno-19-79" href="#__codelineno-19-79"></a>    <span class="p">}</span>
</span><span id="__span-19-80"><a id="__codelineno-19-80" name="__codelineno-19-80" href="#__codelineno-19-80"></a>
</span><span id="__span-19-81"><a id="__codelineno-19-81" name="__codelineno-19-81" href="#__codelineno-19-81"></a>    <span class="c1">// This function will configure and load the URL in the webview</span>
</span><span id="__span-19-82"><a id="__codelineno-19-82" name="__codelineno-19-82" href="#__codelineno-19-82"></a>    <span class="kd">func</span> <span class="nf">configure</span><span class="p">(</span><span class="n">withUrl</span> <span class="n">url</span><span class="p">:</span> <span class="n">URL</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-19-83"><a id="__codelineno-19-83" name="__codelineno-19-83" href="#__codelineno-19-83"></a>        <span class="kd">let</span> <span class="nv">webRequest</span> <span class="p">=</span> <span class="n">URLRequest</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="n">url</span><span class="p">!)</span>
</span><span id="__span-19-84"><a id="__codelineno-19-84" name="__codelineno-19-84" href="#__codelineno-19-84"></a>        <span class="n">webView</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">webRequest</span><span class="p">)</span>
</span><span id="__span-19-85"><a id="__codelineno-19-85" name="__codelineno-19-85" href="#__codelineno-19-85"></a>    <span class="p">}</span>
</span><span id="__span-19-86"><a id="__codelineno-19-86" name="__codelineno-19-86" href="#__codelineno-19-86"></a>
</span><span id="__span-19-87"><a id="__codelineno-19-87" name="__codelineno-19-87" href="#__codelineno-19-87"></a>    <span class="c1">// This function will present the webview on the screen</span>
</span><span id="__span-19-88"><a id="__codelineno-19-88" name="__codelineno-19-88" href="#__codelineno-19-88"></a>    <span class="kd">func</span> <span class="nf">show</span><span class="p">()</span> <span class="p">{</span>
</span><span id="__span-19-89"><a id="__codelineno-19-89" name="__codelineno-19-89" href="#__codelineno-19-89"></a>        <span class="k">guard</span> <span class="kd">let</span> <span class="nv">window</span> <span class="p">=</span> <span class="bp">UIApplication</span><span class="p">.</span><span class="n">shared</span><span class="p">.</span><span class="n">windows</span><span class="p">.</span><span class="bp">filter</span><span class="p">({</span> <span class="nv">$0</span><span class="p">.</span><span class="n">isKeyWindow</span> <span class="p">}).</span><span class="bp">first</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
</span><span id="__span-19-90"><a id="__codelineno-19-90" name="__codelineno-19-90" href="#__codelineno-19-90"></a>
</span><span id="__span-19-91"><a id="__codelineno-19-91" name="__codelineno-19-91" href="#__codelineno-19-91"></a>        <span class="kc">self</span><span class="p">.</span><span class="n">alpha</span> <span class="p">=</span> <span class="mf">0.6</span>
</span><span id="__span-19-92"><a id="__codelineno-19-92" name="__codelineno-19-92" href="#__codelineno-19-92"></a>        <span class="kc">self</span><span class="p">.</span><span class="n">frame</span> <span class="p">=</span> <span class="n">window</span><span class="p">.</span><span class="n">bounds</span>
</span><span id="__span-19-93"><a id="__codelineno-19-93" name="__codelineno-19-93" href="#__codelineno-19-93"></a>        <span class="n">window</span><span class="p">.</span><span class="n">addSubview</span><span class="p">(</span><span class="kc">self</span><span class="p">)</span>
</span><span id="__span-19-94"><a id="__codelineno-19-94" name="__codelineno-19-94" href="#__codelineno-19-94"></a>
</span><span id="__span-19-95"><a id="__codelineno-19-95" name="__codelineno-19-95" href="#__codelineno-19-95"></a>        <span class="bp">UIView</span><span class="p">.</span><span class="n">animate</span><span class="p">(</span><span class="n">withDuration</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-19-96"><a id="__codelineno-19-96" name="__codelineno-19-96" href="#__codelineno-19-96"></a>            <span class="kc">self</span><span class="p">.</span><span class="n">alpha</span> <span class="p">=</span> <span class="mi">1</span>
</span><span id="__span-19-97"><a id="__codelineno-19-97" name="__codelineno-19-97" href="#__codelineno-19-97"></a>        <span class="p">}</span>
</span><span id="__span-19-98"><a id="__codelineno-19-98" name="__codelineno-19-98" href="#__codelineno-19-98"></a>    <span class="p">}</span>
</span><span id="__span-19-99"><a id="__codelineno-19-99" name="__codelineno-19-99" href="#__codelineno-19-99"></a>
</span><span id="__span-19-100"><a id="__codelineno-19-100" name="__codelineno-19-100" href="#__codelineno-19-100"></a>    <span class="kr">@objc</span> <span class="kd">func</span> <span class="nf">cancelAndDismiss</span><span class="p">()</span> <span class="p">{</span>
</span><span id="__span-19-101"><a id="__codelineno-19-101" name="__codelineno-19-101" href="#__codelineno-19-101"></a>        <span class="c1">// Any custom logic you want to run when the user cancels</span>
</span><span id="__span-19-102"><a id="__codelineno-19-102" name="__codelineno-19-102" href="#__codelineno-19-102"></a>        <span class="n">dismiss</span><span class="p">()</span>
</span><span id="__span-19-103"><a id="__codelineno-19-103" name="__codelineno-19-103" href="#__codelineno-19-103"></a>    <span class="p">}</span>
</span><span id="__span-19-104"><a id="__codelineno-19-104" name="__codelineno-19-104" href="#__codelineno-19-104"></a>
</span><span id="__span-19-105"><a id="__codelineno-19-105" name="__codelineno-19-105" href="#__codelineno-19-105"></a>    <span class="kd">func</span> <span class="nf">dismiss</span><span class="p">()</span> <span class="p">{</span>
</span><span id="__span-19-106"><a id="__codelineno-19-106" name="__codelineno-19-106" href="#__codelineno-19-106"></a>        <span class="bp">UIView</span><span class="p">.</span><span class="n">animate</span><span class="p">(</span><span class="n">withDuration</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-19-107"><a id="__codelineno-19-107" name="__codelineno-19-107" href="#__codelineno-19-107"></a>            <span class="kc">self</span><span class="p">.</span><span class="n">alpha</span> <span class="p">=</span> <span class="mi">0</span>
</span><span id="__span-19-108"><a id="__codelineno-19-108" name="__codelineno-19-108" href="#__codelineno-19-108"></a>        <span class="p">}</span> <span class="n">completion</span><span class="p">:</span> <span class="p">{</span> <span class="kc">_</span> <span class="k">in</span>
</span><span id="__span-19-109"><a id="__codelineno-19-109" name="__codelineno-19-109" href="#__codelineno-19-109"></a>            <span class="kc">self</span><span class="p">.</span><span class="n">removeFromSuperview</span><span class="p">()</span>
</span><span id="__span-19-110"><a id="__codelineno-19-110" name="__codelineno-19-110" href="#__codelineno-19-110"></a>        <span class="p">}</span>
</span><span id="__span-19-111"><a id="__codelineno-19-111" name="__codelineno-19-111" href="#__codelineno-19-111"></a>    <span class="p">}</span>
</span><span id="__span-19-112"><a id="__codelineno-19-112" name="__codelineno-19-112" href="#__codelineno-19-112"></a>
</span><span id="__span-19-113"><a id="__codelineno-19-113" name="__codelineno-19-113" href="#__codelineno-19-113"></a>    <span class="kd">func</span> <span class="nf">webView</span><span class="p">(</span><span class="kc">_</span> <span class="n">webView</span><span class="p">:</span> <span class="bp">WKWebView</span><span class="p">,</span> <span class="n">didFinish</span> <span class="n">navigation</span><span class="p">:</span> <span class="bp">WKNavigation</span><span class="p">!)</span> <span class="p">{</span>
</span><span id="__span-19-114"><a id="__codelineno-19-114" name="__codelineno-19-114" href="#__codelineno-19-114"></a>        <span class="n">activityIndicator</span><span class="p">.</span><span class="n">stopAnimating</span><span class="p">()</span>
</span><span id="__span-19-115"><a id="__codelineno-19-115" name="__codelineno-19-115" href="#__codelineno-19-115"></a>    <span class="p">}</span>
</span><span id="__span-19-116"><a id="__codelineno-19-116" name="__codelineno-19-116" href="#__codelineno-19-116"></a>
</span><span id="__span-19-117"><a id="__codelineno-19-117" name="__codelineno-19-117" href="#__codelineno-19-117"></a>    <span class="kd">func</span> <span class="nf">userContentController</span><span class="p">(</span><span class="kc">_</span> <span class="n">userContentController</span><span class="p">:</span> <span class="bp">WKUserContentController</span><span class="p">,</span> <span class="n">didReceive</span> <span class="n">message</span><span class="p">:</span> <span class="bp">WKScriptMessage</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-19-118"><a id="__codelineno-19-118" name="__codelineno-19-118" href="#__codelineno-19-118"></a>        <span class="k">if</span> <span class="n">message</span><span class="p">.</span><span class="n">name</span> <span class="p">==</span> <span class="s">&quot;cb&quot;</span> <span class="p">{</span>
</span><span id="__span-19-119"><a id="__codelineno-19-119" name="__codelineno-19-119" href="#__codelineno-19-119"></a>            <span class="k">if</span> <span class="kd">let</span> <span class="nv">jsonString</span> <span class="p">=</span> <span class="n">message</span><span class="p">.</span><span class="n">body</span> <span class="k">as</span><span class="p">?</span> <span class="nb">String</span><span class="p">,</span>
</span><span id="__span-19-120"><a id="__codelineno-19-120" name="__codelineno-19-120" href="#__codelineno-19-120"></a>            <span class="kd">let</span> <span class="nv">jsonData</span> <span class="p">=</span> <span class="n">jsonString</span><span class="p">.</span><span class="n">data</span><span class="p">(</span><span class="n">using</span><span class="p">:</span> <span class="p">.</span><span class="n">utf8</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-19-121"><a id="__codelineno-19-121" name="__codelineno-19-121" href="#__codelineno-19-121"></a>                <span class="k">do</span> <span class="p">{</span>
</span><span id="__span-19-122"><a id="__codelineno-19-122" name="__codelineno-19-122" href="#__codelineno-19-122"></a>                    <span class="kd">let</span> <span class="nv">clickObj</span> <span class="p">=</span> <span class="k">try</span> <span class="n">JSONSerialization</span><span class="p">.</span><span class="n">jsonObject</span><span class="p">(</span><span class="n">with</span><span class="p">:</span> <span class="n">jsonData</span><span class="p">)</span> <span class="k">as</span><span class="p">?</span> <span class="p">[</span><span class="nb">String</span><span class="p">:</span> <span class="nb">String</span><span class="p">]</span>
</span><span id="__span-19-123"><a id="__codelineno-19-123" name="__codelineno-19-123" href="#__codelineno-19-123"></a>                    <span class="k">if</span> <span class="kd">let</span> <span class="nv">clickObj</span> <span class="p">=</span> <span class="n">clickObj</span> <span class="p">{</span>
</span><span id="__span-19-124"><a id="__codelineno-19-124" name="__codelineno-19-124" href="#__codelineno-19-124"></a>                        <span class="bp">UIApplication</span><span class="p">.</span><span class="n">shared</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">URL</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="n">clickObj</span><span class="p">[</span><span class="s">&quot;clickUrl&quot;</span><span class="p">]</span><span class="o">!</span><span class="p">)</span><span class="o">!</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="p">[:],</span> <span class="n">completionHandler</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
</span><span id="__span-19-125"><a id="__codelineno-19-125" name="__codelineno-19-125" href="#__codelineno-19-125"></a>                    <span class="p">}</span>
</span><span id="__span-19-126"><a id="__codelineno-19-126" name="__codelineno-19-126" href="#__codelineno-19-126"></a>                <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
</span><span id="__span-19-127"><a id="__codelineno-19-127" name="__codelineno-19-127" href="#__codelineno-19-127"></a>                    <span class="c1">// This catch will handle when offers are not present, or any other errors</span>
</span><span id="__span-19-128"><a id="__codelineno-19-128" name="__codelineno-19-128" href="#__codelineno-19-128"></a>                    <span class="n">cancelAndDismiss</span><span class="p">();</span>
</span><span id="__span-19-129"><a id="__codelineno-19-129" name="__codelineno-19-129" href="#__codelineno-19-129"></a>                <span class="p">}</span>
</span><span id="__span-19-130"><a id="__codelineno-19-130" name="__codelineno-19-130" href="#__codelineno-19-130"></a>            <span class="p">}</span>
</span><span id="__span-19-131"><a id="__codelineno-19-131" name="__codelineno-19-131" href="#__codelineno-19-131"></a>        <span class="p">}</span>
</span><span id="__span-19-132"><a id="__codelineno-19-132" name="__codelineno-19-132" href="#__codelineno-19-132"></a>        <span class="n">dismiss</span><span class="p">()</span>
</span><span id="__span-19-133"><a id="__codelineno-19-133" name="__codelineno-19-133" href="#__codelineno-19-133"></a>    <span class="p">}</span>
</span><span id="__span-19-134"><a id="__codelineno-19-134" name="__codelineno-19-134" href="#__codelineno-19-134"></a><span class="p">}</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-objc highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="k">@interface</span> <span class="nc">InterstitialView</span> : <span class="bp">UIView</span><span class="w"> </span><span class="o">&lt;</span><span class="bp">WKNavigationDelegate</span><span class="p">,</span><span class="w"> </span><span class="bp">WKScriptMessageHandler</span><span class="o">&gt;</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="k">@property</span><span class="w"> </span><span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span><span class="w"> </span><span class="k">strong</span><span class="p">)</span><span class="w"> </span><span class="bp">UIView</span><span class="w"> </span><span class="o">*</span><span class="n">contentView</span><span class="p">;</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="k">@property</span><span class="w"> </span><span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span><span class="w"> </span><span class="k">strong</span><span class="p">)</span><span class="w"> </span><span class="bp">WKWebView</span><span class="w"> </span><span class="o">*</span><span class="n">webView</span><span class="p">;</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="k">@property</span><span class="w"> </span><span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span><span class="w"> </span><span class="k">strong</span><span class="p">)</span><span class="w"> </span><span class="bp">UIActivityIndicatorView</span><span class="w"> </span><span class="o">*</span><span class="n">activityIndicator</span><span class="p">;</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="k">@property</span><span class="w"> </span><span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span><span class="w"> </span><span class="k">strong</span><span class="p">)</span><span class="w"> </span><span class="bp">UIButton</span><span class="w"> </span><span class="o">*</span><span class="n">closeButton</span><span class="p">;</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="k">@property</span><span class="w"> </span><span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span><span class="w"> </span><span class="k">strong</span><span class="p">)</span><span class="w"> </span><span class="n">OfferRequest</span><span class="w"> </span><span class="o">*</span><span class="n">lastOfferRequest</span><span class="p">;</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="k">@end</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="k">@implementation</span> <span class="nc">InterstitialView</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="p">-</span> <span class="p">(</span><span class="kt">instancetype</span><span class="p">)</span><span class="nf">initWithFrame:</span><span class="p">(</span><span class="n">CGRect</span><span class="p">)</span><span class="nv">frame</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="w">    </span><span class="bp">WKWebViewConfiguration</span><span class="w"> </span><span class="o">*</span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="bp">WKWebViewConfiguration</span><span class="w"> </span><span class="n">alloc</span><span class="p">]</span><span class="w"> </span><span class="n">init</span><span class="p">];</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="w">    </span><span class="nb">self</span><span class="p">.</span><span class="n">webView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="bp">WKWebView</span><span class="w"> </span><span class="n">alloc</span><span class="p">]</span><span class="w"> </span><span class="n">initWithFrame</span><span class="o">:</span><span class="n">CGRectZero</span><span class="w"> </span><span class="n">configuration</span><span class="o">:</span><span class="n">config</span><span class="p">];</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a><span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">webView</span><span class="w"> </span><span class="n">loadHTMLString</span><span class="o">:</span><span class="s">@&quot;&quot;</span><span class="w"> </span><span class="n">baseURL</span><span class="o">:</span><span class="nb">nil</span><span class="p">];</span>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a><span class="w">    </span><span class="nb">self</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nb">super</span><span class="w"> </span><span class="n">initWithFrame</span><span class="o">:</span><span class="n">frame</span><span class="p">];</span>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a><span class="w">        </span><span class="bp">WKUserContentController</span><span class="w"> </span><span class="o">*</span><span class="n">contentController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">self</span><span class="p">.</span><span class="n">webView</span><span class="p">.</span><span class="n">configuration</span><span class="p">.</span><span class="n">userContentController</span><span class="p">;</span>
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a><span class="w">        </span><span class="p">[</span><span class="n">contentController</span><span class="w"> </span><span class="n">addScriptMessageHandler</span><span class="o">:</span><span class="nb">self</span><span class="w"> </span><span class="n">name</span><span class="o">:</span><span class="s">@&quot;cb&quot;</span><span class="p">];</span>
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a>
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a><span class="w">        </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">setupViews</span><span class="p">];</span>
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-20-23"><a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">self</span><span class="p">;</span>
</span><span id="__span-20-24"><a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a><span class="p">}</span>
</span><span id="__span-20-25"><a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a>
</span><span id="__span-20-26"><a id="__codelineno-20-26" name="__codelineno-20-26" href="#__codelineno-20-26"></a><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setupViews</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-27"><a id="__codelineno-20-27" name="__codelineno-20-27" href="#__codelineno-20-27"></a><span class="w">    </span><span class="nb">self</span><span class="p">.</span><span class="n">backgroundColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="bp">UIColor</span><span class="w"> </span><span class="n">blackColor</span><span class="p">]</span><span class="w"> </span><span class="n">colorWithAlphaComponent</span><span class="o">:</span><span class="mf">0.6</span><span class="p">];</span>
</span><span id="__span-20-28"><a id="__codelineno-20-28" name="__codelineno-20-28" href="#__codelineno-20-28"></a>
</span><span id="__span-20-29"><a id="__codelineno-20-29" name="__codelineno-20-29" href="#__codelineno-20-29"></a><span class="w">    </span><span class="c1">// Content view configuration</span>
</span><span id="__span-20-30"><a id="__codelineno-20-30" name="__codelineno-20-30" href="#__codelineno-20-30"></a><span class="w">    </span><span class="nb">self</span><span class="p">.</span><span class="n">contentView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="bp">UIView</span><span class="w"> </span><span class="n">alloc</span><span class="p">]</span><span class="w"> </span><span class="n">init</span><span class="p">];</span>
</span><span id="__span-20-31"><a id="__codelineno-20-31" name="__codelineno-20-31" href="#__codelineno-20-31"></a><span class="w">    </span><span class="nb">self</span><span class="p">.</span><span class="n">contentView</span><span class="p">.</span><span class="n">backgroundColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="bp">UIColor</span><span class="w"> </span><span class="n">whiteColor</span><span class="p">];</span>
</span><span id="__span-20-32"><a id="__codelineno-20-32" name="__codelineno-20-32" href="#__codelineno-20-32"></a><span class="w">    </span><span class="nb">self</span><span class="p">.</span><span class="n">contentView</span><span class="p">.</span><span class="n">layer</span><span class="p">.</span><span class="n">cornerRadius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">12.0</span><span class="p">;</span>
</span><span id="__span-20-33"><a id="__codelineno-20-33" name="__codelineno-20-33" href="#__codelineno-20-33"></a><span class="w">    </span><span class="nb">self</span><span class="p">.</span><span class="n">contentView</span><span class="p">.</span><span class="n">clipsToBounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">YES</span><span class="p">;</span>
</span><span id="__span-20-34"><a id="__codelineno-20-34" name="__codelineno-20-34" href="#__codelineno-20-34"></a><span class="w">    </span><span class="nb">self</span><span class="p">.</span><span class="n">contentView</span><span class="p">.</span><span class="n">translatesAutoresizingMaskIntoConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NO</span><span class="p">;</span>
</span><span id="__span-20-35"><a id="__codelineno-20-35" name="__codelineno-20-35" href="#__codelineno-20-35"></a><span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">addSubview</span><span class="o">:</span><span class="nb">self</span><span class="p">.</span><span class="n">contentView</span><span class="p">];</span>
</span><span id="__span-20-36"><a id="__codelineno-20-36" name="__codelineno-20-36" href="#__codelineno-20-36"></a>
</span><span id="__span-20-37"><a id="__codelineno-20-37" name="__codelineno-20-37" href="#__codelineno-20-37"></a><span class="w">    </span><span class="nb">self</span><span class="p">.</span><span class="n">webView</span><span class="p">.</span><span class="n">translatesAutoresizingMaskIntoConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NO</span><span class="p">;</span>
</span><span id="__span-20-38"><a id="__codelineno-20-38" name="__codelineno-20-38" href="#__codelineno-20-38"></a><span class="w">    </span><span class="nb">self</span><span class="p">.</span><span class="n">webView</span><span class="p">.</span><span class="n">scrollView</span><span class="p">.</span><span class="n">contentInset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UIEdgeInsetsZero</span><span class="p">;</span>
</span><span id="__span-20-39"><a id="__codelineno-20-39" name="__codelineno-20-39" href="#__codelineno-20-39"></a><span class="w">    </span><span class="nb">self</span><span class="p">.</span><span class="n">webView</span><span class="p">.</span><span class="n">scrollView</span><span class="p">.</span><span class="n">bounces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NO</span><span class="p">;</span>
</span><span id="__span-20-40"><a id="__codelineno-20-40" name="__codelineno-20-40" href="#__codelineno-20-40"></a><span class="w">    </span><span class="nb">self</span><span class="p">.</span><span class="n">webView</span><span class="p">.</span><span class="n">navigationDelegate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">self</span><span class="p">;</span>
</span><span id="__span-20-41"><a id="__codelineno-20-41" name="__codelineno-20-41" href="#__codelineno-20-41"></a><span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">contentView</span><span class="w"> </span><span class="n">addSubview</span><span class="o">:</span><span class="nb">self</span><span class="p">.</span><span class="n">webView</span><span class="p">];</span>
</span><span id="__span-20-42"><a id="__codelineno-20-42" name="__codelineno-20-42" href="#__codelineno-20-42"></a>
</span><span id="__span-20-43"><a id="__codelineno-20-43" name="__codelineno-20-43" href="#__codelineno-20-43"></a><span class="w">    </span><span class="c1">// Activity Indicator configuration</span>
</span><span id="__span-20-44"><a id="__codelineno-20-44" name="__codelineno-20-44" href="#__codelineno-20-44"></a><span class="w">    </span><span class="nb">self</span><span class="p">.</span><span class="n">activityIndicator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="bp">UIActivityIndicatorView</span><span class="w"> </span><span class="n">alloc</span><span class="p">]</span><span class="w"> </span><span class="n">initWithActivityIndicatorStyle</span><span class="o">:</span><span class="n">UIActivityIndicatorViewStyleLarge</span><span class="p">];</span>
</span><span id="__span-20-45"><a id="__codelineno-20-45" name="__codelineno-20-45" href="#__codelineno-20-45"></a><span class="w">    </span><span class="nb">self</span><span class="p">.</span><span class="n">activityIndicator</span><span class="p">.</span><span class="n">translatesAutoresizingMaskIntoConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NO</span><span class="p">;</span>
</span><span id="__span-20-46"><a id="__codelineno-20-46" name="__codelineno-20-46" href="#__codelineno-20-46"></a><span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">contentView</span><span class="w"> </span><span class="n">addSubview</span><span class="o">:</span><span class="nb">self</span><span class="p">.</span><span class="n">activityIndicator</span><span class="p">];</span>
</span><span id="__span-20-47"><a id="__codelineno-20-47" name="__codelineno-20-47" href="#__codelineno-20-47"></a><span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">activityIndicator</span><span class="w"> </span><span class="n">startAnimating</span><span class="p">];</span>
</span><span id="__span-20-48"><a id="__codelineno-20-48" name="__codelineno-20-48" href="#__codelineno-20-48"></a>
</span><span id="__span-20-49"><a id="__codelineno-20-49" name="__codelineno-20-49" href="#__codelineno-20-49"></a><span class="w">    </span><span class="nb">self</span><span class="p">.</span><span class="n">closeButton</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="bp">UIButton</span><span class="w"> </span><span class="n">buttonWithType</span><span class="o">:</span><span class="n">UIButtonTypeCustom</span><span class="p">];</span>
</span><span id="__span-20-50"><a id="__codelineno-20-50" name="__codelineno-20-50" href="#__codelineno-20-50"></a><span class="w">    </span><span class="nb">self</span><span class="p">.</span><span class="n">closeButton</span><span class="p">.</span><span class="n">translatesAutoresizingMaskIntoConstraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NO</span><span class="p">;</span>
</span><span id="__span-20-51"><a id="__codelineno-20-51" name="__codelineno-20-51" href="#__codelineno-20-51"></a><span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">closeButton</span><span class="w"> </span><span class="n">setTitle</span><span class="o">:</span><span class="s">@&quot;x&quot;</span><span class="w"> </span><span class="n">forState</span><span class="o">:</span><span class="n">UIControlStateNormal</span><span class="p">];</span>
</span><span id="__span-20-52"><a id="__codelineno-20-52" name="__codelineno-20-52" href="#__codelineno-20-52"></a><span class="w">    </span><span class="nb">self</span><span class="p">.</span><span class="n">closeButton</span><span class="p">.</span><span class="n">titleLabel</span><span class="p">.</span><span class="n">font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="bp">UIFont</span><span class="w"> </span><span class="n">monospacedSystemFontOfSize</span><span class="o">:</span><span class="mi">20</span><span class="w"> </span><span class="n">weight</span><span class="o">:</span><span class="n">UIFontWeightRegular</span><span class="p">];</span>
</span><span id="__span-20-53"><a id="__codelineno-20-53" name="__codelineno-20-53" href="#__codelineno-20-53"></a><span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">closeButton</span><span class="w"> </span><span class="n">setTitleColor</span><span class="o">:</span><span class="bp">UIColor</span><span class="p">.</span><span class="n">grayColor</span><span class="w"> </span><span class="n">forState</span><span class="o">:</span><span class="n">UIControlStateNormal</span><span class="p">];</span>
</span><span id="__span-20-54"><a id="__codelineno-20-54" name="__codelineno-20-54" href="#__codelineno-20-54"></a><span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">closeButton</span><span class="w"> </span><span class="n">addTarget</span><span class="o">:</span><span class="nb">self</span><span class="w"> </span><span class="n">action</span><span class="o">:</span><span class="k">@selector</span><span class="p">(</span><span class="n">cancelAndDismiss</span><span class="p">)</span><span class="w"> </span><span class="n">forControlEvents</span><span class="o">:</span><span class="n">UIControlEventTouchUpInside</span><span class="p">];</span>
</span><span id="__span-20-55"><a id="__codelineno-20-55" name="__codelineno-20-55" href="#__codelineno-20-55"></a><span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">addSubview</span><span class="o">:</span><span class="nb">self</span><span class="p">.</span><span class="n">closeButton</span><span class="p">];</span>
</span><span id="__span-20-56"><a id="__codelineno-20-56" name="__codelineno-20-56" href="#__codelineno-20-56"></a>
</span><span id="__span-20-57"><a id="__codelineno-20-57" name="__codelineno-20-57" href="#__codelineno-20-57"></a><span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">setupConstraints</span><span class="p">];</span>
</span><span id="__span-20-58"><a id="__codelineno-20-58" name="__codelineno-20-58" href="#__codelineno-20-58"></a><span class="p">}</span>
</span><span id="__span-20-59"><a id="__codelineno-20-59" name="__codelineno-20-59" href="#__codelineno-20-59"></a>
</span><span id="__span-20-60"><a id="__codelineno-20-60" name="__codelineno-20-60" href="#__codelineno-20-60"></a><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setupConstraints</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-61"><a id="__codelineno-20-61" name="__codelineno-20-61" href="#__codelineno-20-61"></a><span class="w">    </span><span class="p">[</span><span class="bp">NSLayoutConstraint</span><span class="w"> </span><span class="n">activateConstraints</span><span class="o">:</span><span class="l">@[</span>
</span><span id="__span-20-62"><a id="__codelineno-20-62" name="__codelineno-20-62" href="#__codelineno-20-62"></a><span class="w">        </span><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">contentView</span><span class="p">.</span><span class="n">centerYAnchor</span><span class="w"> </span><span class="n">constraintEqualToAnchor</span><span class="o">:</span><span class="nb">self</span><span class="p">.</span><span class="n">centerYAnchor</span><span class="p">],</span>
</span><span id="__span-20-63"><a id="__codelineno-20-63" name="__codelineno-20-63" href="#__codelineno-20-63"></a><span class="w">        </span><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">contentView</span><span class="p">.</span><span class="n">centerXAnchor</span><span class="w"> </span><span class="n">constraintEqualToAnchor</span><span class="o">:</span><span class="nb">self</span><span class="p">.</span><span class="n">centerXAnchor</span><span class="p">],</span>
</span><span id="__span-20-64"><a id="__codelineno-20-64" name="__codelineno-20-64" href="#__codelineno-20-64"></a><span class="w">        </span><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">contentView</span><span class="p">.</span><span class="n">widthAnchor</span><span class="w"> </span><span class="n">constraintEqualToAnchor</span><span class="o">:</span><span class="nb">self</span><span class="p">.</span><span class="n">widthAnchor</span><span class="w"> </span><span class="n">multiplier</span><span class="o">:</span><span class="mf">0.9</span><span class="p">],</span>
</span><span id="__span-20-65"><a id="__codelineno-20-65" name="__codelineno-20-65" href="#__codelineno-20-65"></a><span class="w">        </span><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">contentView</span><span class="p">.</span><span class="n">heightAnchor</span><span class="w"> </span><span class="n">constraintEqualToAnchor</span><span class="o">:</span><span class="nb">self</span><span class="p">.</span><span class="n">heightAnchor</span><span class="w"> </span><span class="n">multiplier</span><span class="o">:</span><span class="mf">0.8</span><span class="p">],</span>
</span><span id="__span-20-66"><a id="__codelineno-20-66" name="__codelineno-20-66" href="#__codelineno-20-66"></a>
</span><span id="__span-20-67"><a id="__codelineno-20-67" name="__codelineno-20-67" href="#__codelineno-20-67"></a><span class="w">        </span><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">webView</span><span class="p">.</span><span class="n">topAnchor</span><span class="w"> </span><span class="n">constraintEqualToAnchor</span><span class="o">:</span><span class="nb">self</span><span class="p">.</span><span class="n">contentView</span><span class="p">.</span><span class="n">topAnchor</span><span class="p">],</span>
</span><span id="__span-20-68"><a id="__codelineno-20-68" name="__codelineno-20-68" href="#__codelineno-20-68"></a><span class="w">        </span><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">webView</span><span class="p">.</span><span class="n">leftAnchor</span><span class="w"> </span><span class="n">constraintEqualToAnchor</span><span class="o">:</span><span class="nb">self</span><span class="p">.</span><span class="n">contentView</span><span class="p">.</span><span class="n">leftAnchor</span><span class="p">],</span>
</span><span id="__span-20-69"><a id="__codelineno-20-69" name="__codelineno-20-69" href="#__codelineno-20-69"></a><span class="w">        </span><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">webView</span><span class="p">.</span><span class="n">rightAnchor</span><span class="w"> </span><span class="n">constraintEqualToAnchor</span><span class="o">:</span><span class="nb">self</span><span class="p">.</span><span class="n">contentView</span><span class="p">.</span><span class="n">rightAnchor</span><span class="p">],</span>
</span><span id="__span-20-70"><a id="__codelineno-20-70" name="__codelineno-20-70" href="#__codelineno-20-70"></a><span class="w">        </span><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">webView</span><span class="p">.</span><span class="n">bottomAnchor</span><span class="w"> </span><span class="n">constraintEqualToAnchor</span><span class="o">:</span><span class="nb">self</span><span class="p">.</span><span class="n">contentView</span><span class="p">.</span><span class="n">bottomAnchor</span><span class="p">],</span>
</span><span id="__span-20-71"><a id="__codelineno-20-71" name="__codelineno-20-71" href="#__codelineno-20-71"></a>
</span><span id="__span-20-72"><a id="__codelineno-20-72" name="__codelineno-20-72" href="#__codelineno-20-72"></a><span class="w">        </span><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">activityIndicator</span><span class="p">.</span><span class="n">centerXAnchor</span><span class="w"> </span><span class="n">constraintEqualToAnchor</span><span class="o">:</span><span class="nb">self</span><span class="p">.</span><span class="n">contentView</span><span class="p">.</span><span class="n">centerXAnchor</span><span class="p">],</span>
</span><span id="__span-20-73"><a id="__codelineno-20-73" name="__codelineno-20-73" href="#__codelineno-20-73"></a><span class="w">        </span><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">activityIndicator</span><span class="p">.</span><span class="n">centerYAnchor</span><span class="w"> </span><span class="n">constraintEqualToAnchor</span><span class="o">:</span><span class="nb">self</span><span class="p">.</span><span class="n">contentView</span><span class="p">.</span><span class="n">centerYAnchor</span><span class="p">],</span>
</span><span id="__span-20-74"><a id="__codelineno-20-74" name="__codelineno-20-74" href="#__codelineno-20-74"></a>
</span><span id="__span-20-75"><a id="__codelineno-20-75" name="__codelineno-20-75" href="#__codelineno-20-75"></a><span class="w">        </span><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">closeButton</span><span class="p">.</span><span class="n">topAnchor</span><span class="w"> </span><span class="n">constraintEqualToAnchor</span><span class="o">:</span><span class="nb">self</span><span class="p">.</span><span class="n">contentView</span><span class="p">.</span><span class="n">topAnchor</span><span class="w"> </span><span class="n">constant</span><span class="o">:</span><span class="mi">8</span><span class="p">],</span>
</span><span id="__span-20-76"><a id="__codelineno-20-76" name="__codelineno-20-76" href="#__codelineno-20-76"></a><span class="w">        </span><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">closeButton</span><span class="p">.</span><span class="n">trailingAnchor</span><span class="w"> </span><span class="n">constraintEqualToAnchor</span><span class="o">:</span><span class="nb">self</span><span class="p">.</span><span class="n">contentView</span><span class="p">.</span><span class="n">trailingAnchor</span><span class="w"> </span><span class="n">constant</span><span class="o">:</span><span class="mi">-8</span><span class="p">],</span>
</span><span id="__span-20-77"><a id="__codelineno-20-77" name="__codelineno-20-77" href="#__codelineno-20-77"></a><span class="w">        </span><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">closeButton</span><span class="p">.</span><span class="n">widthAnchor</span><span class="w"> </span><span class="n">constraintEqualToConstant</span><span class="o">:</span><span class="mi">30</span><span class="p">],</span>
</span><span id="__span-20-78"><a id="__codelineno-20-78" name="__codelineno-20-78" href="#__codelineno-20-78"></a><span class="w">        </span><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">closeButton</span><span class="p">.</span><span class="n">heightAnchor</span><span class="w"> </span><span class="n">constraintEqualToConstant</span><span class="o">:</span><span class="mi">30</span><span class="p">]</span>
</span><span id="__span-20-79"><a id="__codelineno-20-79" name="__codelineno-20-79" href="#__codelineno-20-79"></a><span class="w">    </span><span class="l">]</span><span class="p">];</span>
</span><span id="__span-20-80"><a id="__codelineno-20-80" name="__codelineno-20-80" href="#__codelineno-20-80"></a><span class="p">}</span>
</span><span id="__span-20-81"><a id="__codelineno-20-81" name="__codelineno-20-81" href="#__codelineno-20-81"></a>
</span><span id="__span-20-82"><a id="__codelineno-20-82" name="__codelineno-20-82" href="#__codelineno-20-82"></a><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">configureWithUrl:</span><span class="p">(</span><span class="bp">NSURL</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nv">url</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-83"><a id="__codelineno-20-83" name="__codelineno-20-83" href="#__codelineno-20-83"></a><span class="w">    </span><span class="bp">NSURLRequest</span><span class="w"> </span><span class="o">*</span><span class="n">webRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="bp">NSURLRequest</span><span class="w"> </span><span class="n">requestWithURL</span><span class="o">:</span><span class="n">url</span><span class="p">];</span>
</span><span id="__span-20-84"><a id="__codelineno-20-84" name="__codelineno-20-84" href="#__codelineno-20-84"></a><span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">webView</span><span class="w"> </span><span class="n">loadRequest</span><span class="o">:</span><span class="n">webRequest</span><span class="p">];</span>
</span><span id="__span-20-85"><a id="__codelineno-20-85" name="__codelineno-20-85" href="#__codelineno-20-85"></a><span class="p">}</span>
</span><span id="__span-20-86"><a id="__codelineno-20-86" name="__codelineno-20-86" href="#__codelineno-20-86"></a>
</span><span id="__span-20-87"><a id="__codelineno-20-87" name="__codelineno-20-87" href="#__codelineno-20-87"></a><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">show</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-88"><a id="__codelineno-20-88" name="__codelineno-20-88" href="#__codelineno-20-88"></a><span class="w">    </span><span class="bp">UIWindow</span><span class="w"> </span><span class="o">*</span><span class="n">window</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="bp">UIApplication</span><span class="w"> </span><span class="n">sharedApplication</span><span class="p">].</span><span class="n">windows</span><span class="w"> </span><span class="n">filteredArrayUsingPredicate</span><span class="o">:</span><span class="p">[</span><span class="bp">NSPredicate</span><span class="w"> </span><span class="n">predicateWithFormat</span><span class="o">:</span><span class="s">@&quot;isKeyWindow == YES&quot;</span><span class="p">]].</span><span class="n">firstObject</span><span class="p">;</span>
</span><span id="__span-20-89"><a id="__codelineno-20-89" name="__codelineno-20-89" href="#__codelineno-20-89"></a><span class="w">    </span><span class="nb">self</span><span class="p">.</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.6</span><span class="p">;</span>
</span><span id="__span-20-90"><a id="__codelineno-20-90" name="__codelineno-20-90" href="#__codelineno-20-90"></a><span class="w">    </span><span class="nb">self</span><span class="p">.</span><span class="n">frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">bounds</span><span class="p">;</span>
</span><span id="__span-20-91"><a id="__codelineno-20-91" name="__codelineno-20-91" href="#__codelineno-20-91"></a><span class="w">    </span><span class="p">[</span><span class="n">window</span><span class="w"> </span><span class="n">addSubview</span><span class="o">:</span><span class="nb">self</span><span class="p">];</span>
</span><span id="__span-20-92"><a id="__codelineno-20-92" name="__codelineno-20-92" href="#__codelineno-20-92"></a>
</span><span id="__span-20-93"><a id="__codelineno-20-93" name="__codelineno-20-93" href="#__codelineno-20-93"></a><span class="w">    </span><span class="p">[</span><span class="bp">UIView</span><span class="w"> </span><span class="n">animateWithDuration</span><span class="o">:</span><span class="mf">0.3</span><span class="w"> </span><span class="n">animations</span><span class="o">:^</span><span class="p">{</span>
</span><span id="__span-20-94"><a id="__codelineno-20-94" name="__codelineno-20-94" href="#__codelineno-20-94"></a><span class="w">        </span><span class="nb">self</span><span class="p">.</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-20-95"><a id="__codelineno-20-95" name="__codelineno-20-95" href="#__codelineno-20-95"></a><span class="w">    </span><span class="p">}];</span>
</span><span id="__span-20-96"><a id="__codelineno-20-96" name="__codelineno-20-96" href="#__codelineno-20-96"></a><span class="p">}</span>
</span><span id="__span-20-97"><a id="__codelineno-20-97" name="__codelineno-20-97" href="#__codelineno-20-97"></a>
</span><span id="__span-20-98"><a id="__codelineno-20-98" name="__codelineno-20-98" href="#__codelineno-20-98"></a><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">cancelAndDismiss</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-99"><a id="__codelineno-20-99" name="__codelineno-20-99" href="#__codelineno-20-99"></a><span class="w">    </span><span class="c1">// Any custom logic you want to run when the user cancels</span>
</span><span id="__span-20-100"><a id="__codelineno-20-100" name="__codelineno-20-100" href="#__codelineno-20-100"></a><span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">dismiss</span><span class="p">];</span>
</span><span id="__span-20-101"><a id="__codelineno-20-101" name="__codelineno-20-101" href="#__codelineno-20-101"></a><span class="p">}</span>
</span><span id="__span-20-102"><a id="__codelineno-20-102" name="__codelineno-20-102" href="#__codelineno-20-102"></a>
</span><span id="__span-20-103"><a id="__codelineno-20-103" name="__codelineno-20-103" href="#__codelineno-20-103"></a><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">dismiss</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-104"><a id="__codelineno-20-104" name="__codelineno-20-104" href="#__codelineno-20-104"></a><span class="w">    </span><span class="p">[</span><span class="bp">UIView</span><span class="w"> </span><span class="n">animateWithDuration</span><span class="o">:</span><span class="mf">0.3</span><span class="w"> </span><span class="n">animations</span><span class="o">:^</span><span class="p">{</span>
</span><span id="__span-20-105"><a id="__codelineno-20-105" name="__codelineno-20-105" href="#__codelineno-20-105"></a><span class="w">        </span><span class="nb">self</span><span class="p">.</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-20-106"><a id="__codelineno-20-106" name="__codelineno-20-106" href="#__codelineno-20-106"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">completion</span><span class="o">:^</span><span class="p">(</span><span class="kt">BOOL</span><span class="w"> </span><span class="n">finished</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-107"><a id="__codelineno-20-107" name="__codelineno-20-107" href="#__codelineno-20-107"></a><span class="w">        </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">removeFromSuperview</span><span class="p">];</span>
</span><span id="__span-20-108"><a id="__codelineno-20-108" name="__codelineno-20-108" href="#__codelineno-20-108"></a><span class="w">    </span><span class="p">}];</span>
</span><span id="__span-20-109"><a id="__codelineno-20-109" name="__codelineno-20-109" href="#__codelineno-20-109"></a><span class="p">}</span>
</span><span id="__span-20-110"><a id="__codelineno-20-110" name="__codelineno-20-110" href="#__codelineno-20-110"></a>
</span><span id="__span-20-111"><a id="__codelineno-20-111" name="__codelineno-20-111" href="#__codelineno-20-111"></a><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">webView:</span><span class="p">(</span><span class="bp">WKWebView</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nv">webView</span><span class="w"> </span><span class="nf">didFinishNavigation:</span><span class="p">(</span><span class="bp">WKNavigation</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nv">navigation</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-112"><a id="__codelineno-20-112" name="__codelineno-20-112" href="#__codelineno-20-112"></a><span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">activityIndicator</span><span class="w"> </span><span class="n">stopAnimating</span><span class="p">];</span>
</span><span id="__span-20-113"><a id="__codelineno-20-113" name="__codelineno-20-113" href="#__codelineno-20-113"></a><span class="p">}</span>
</span><span id="__span-20-114"><a id="__codelineno-20-114" name="__codelineno-20-114" href="#__codelineno-20-114"></a>
</span><span id="__span-20-115"><a id="__codelineno-20-115" name="__codelineno-20-115" href="#__codelineno-20-115"></a><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">userContentController:</span><span class="p">(</span><span class="bp">WKUserContentController</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nv">userContentController</span><span class="w"> </span><span class="nf">didReceiveMessage:</span><span class="p">(</span><span class="bp">WKScriptMessage</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nv">message</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-116"><a id="__codelineno-20-116" name="__codelineno-20-116" href="#__codelineno-20-116"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">([</span><span class="n">message</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="n">isEqualToString</span><span class="o">:</span><span class="s">@&quot;cb&quot;</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-117"><a id="__codelineno-20-117" name="__codelineno-20-117" href="#__codelineno-20-117"></a><span class="w">        </span><span class="c1">// Attempt to parse the JSON string into a dictionary</span>
</span><span id="__span-20-118"><a id="__codelineno-20-118" name="__codelineno-20-118" href="#__codelineno-20-118"></a><span class="w">        </span><span class="bp">NSError</span><span class="w"> </span><span class="o">*</span><span class="n">error</span><span class="p">;</span>
</span><span id="__span-20-119"><a id="__codelineno-20-119" name="__codelineno-20-119" href="#__codelineno-20-119"></a><span class="w">        </span><span class="bp">NSDictionary</span><span class="w"> </span><span class="o">*</span><span class="n">clickObj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="bp">NSJSONSerialization</span><span class="w"> </span><span class="n">JSONObjectWithData</span><span class="o">:</span><span class="p">[</span><span class="n">message</span><span class="p">.</span><span class="n">body</span><span class="w"> </span><span class="n">dataUsingEncoding</span><span class="o">:</span><span class="n">NSUTF8StringEncoding</span><span class="p">]</span><span class="w"> </span><span class="n">options</span><span class="o">:</span><span class="mi">0</span><span class="w"> </span><span class="n">error</span><span class="o">:&amp;</span><span class="n">error</span><span class="p">];</span>
</span><span id="__span-20-120"><a id="__codelineno-20-120" name="__codelineno-20-120" href="#__codelineno-20-120"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-121"><a id="__codelineno-20-121" name="__codelineno-20-121" href="#__codelineno-20-121"></a><span class="w">            </span><span class="c1">// This catch will handle when offers are not present, or any other errors</span>
</span><span id="__span-20-122"><a id="__codelineno-20-122" name="__codelineno-20-122" href="#__codelineno-20-122"></a><span class="w">            </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">cancelAndDismiss</span><span class="p">];</span>
</span><span id="__span-20-123"><a id="__codelineno-20-123" name="__codelineno-20-123" href="#__codelineno-20-123"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-124"><a id="__codelineno-20-124" name="__codelineno-20-124" href="#__codelineno-20-124"></a><span class="w">            </span><span class="p">[[</span><span class="bp">UIApplication</span><span class="w"> </span><span class="n">sharedApplication</span><span class="p">]</span><span class="w"> </span><span class="n">openURL</span><span class="o">:</span><span class="p">[</span><span class="bp">NSURL</span><span class="w"> </span><span class="n">URLWithString</span><span class="o">:</span><span class="n">clickObj</span><span class="p">[</span><span class="s">@&quot;clickUrl&quot;</span><span class="p">]]</span><span class="w"> </span><span class="n">options</span><span class="o">:</span><span class="l">@{}</span><span class="w"> </span><span class="n">completionHandler</span><span class="o">:</span><span class="nb">nil</span><span class="p">];</span>
</span><span id="__span-20-125"><a id="__codelineno-20-125" name="__codelineno-20-125" href="#__codelineno-20-125"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-20-126"><a id="__codelineno-20-126" name="__codelineno-20-126" href="#__codelineno-20-126"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-20-127"><a id="__codelineno-20-127" name="__codelineno-20-127" href="#__codelineno-20-127"></a><span class="w">    </span><span class="c1">// If reached this point, dismiss the webview</span>
</span><span id="__span-20-128"><a id="__codelineno-20-128" name="__codelineno-20-128" href="#__codelineno-20-128"></a><span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">dismiss</span><span class="p">];</span>
</span><span id="__span-20-129"><a id="__codelineno-20-129" name="__codelineno-20-129" href="#__codelineno-20-129"></a><span class="p">}</span>
</span><span id="__span-20-130"><a id="__codelineno-20-130" name="__codelineno-20-130" href="#__codelineno-20-130"></a>
</span><span id="__span-20-131"><a id="__codelineno-20-131" name="__codelineno-20-131" href="#__codelineno-20-131"></a><span class="k">@end</span>
</span></code></pre></div>
</div>
</div>
</div>
<h3 id="android-interstitial-view-example">Android Interstitial View Example</h3>
<h4 id="using-the-below-android-interstitial">Using the below Android interstitial</h4>
<p>To use the below Android interstitial, you can create an instance of the <code>InterstitialView</code> class, configure it with the URL you want to load, and then present it on the screen.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="10:2"><input checked="checked" id="__tabbed_10_1" name="__tabbed_10" type="radio" /><input id="__tabbed_10_2" name="__tabbed_10" type="radio" /><div class="tabbed-labels"><label for="__tabbed_10_1">Java</label><label for="__tabbed_10_2">Kotlin</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-java highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="n">InterstitialView</span><span class="w"> </span><span class="n">interstitialView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">InterstitialView</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="n">interstitialView</span><span class="p">.</span><span class="na">loadUrl</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="n">interstitialView</span><span class="p">.</span><span class="na">show</span><span class="p">(</span><span class="n">activity</span><span class="p">);</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="kd">val</span><span class="w"> </span><span class="nv">interstitialView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InterstitialView</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="n">interstitialView</span><span class="p">.</span><span class="na">loadUrl</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="n">interstitialView</span><span class="p">.</span><span class="na">show</span><span class="p">(</span><span class="n">activity</span><span class="p">)</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="webview-interstitial-view-in-android">Webview interstitial view in Android</h4>
<div class="tabbed-set tabbed-alternate" data-tabs="11:2"><input checked="checked" id="__tabbed_11_1" name="__tabbed_11" type="radio" /><input id="__tabbed_11_2" name="__tabbed_11" type="radio" /><div class="tabbed-labels"><label for="__tabbed_11_1">Java</label><label for="__tabbed_11_2">Kotlin</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-java highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">android.app.Activity</span><span class="p">;</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">android.content.Context</span><span class="p">;</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">android.content.Intent</span><span class="p">;</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">android.graphics.drawable.ShapeDrawable</span><span class="p">;</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">android.graphics.drawable.shapes.RoundRectShape</span><span class="p">;</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">android.net.Uri</span><span class="p">;</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">android.view.ViewOutlineProvider</span><span class="p">;</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">android.webkit.JavascriptInterface</span><span class="p">;</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">android.webkit.WebView</span><span class="p">;</span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">android.webkit.WebViewClient</span><span class="p">;</span>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">android.widget.FrameLayout</span><span class="p">;</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="kn">import</span><span class="w"> </span><span class="nn">android.widget.ProgressBar</span><span class="p">;</span>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="kn">import</span><span class="w"> </span><span class="nn">android.widget.Button</span><span class="p">;</span>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="kn">import</span><span class="w"> </span><span class="nn">android.view.ViewGroup</span><span class="p">;</span>
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="kn">import</span><span class="w"> </span><span class="nn">android.view.Gravity</span><span class="p">;</span>
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="kn">import</span><span class="w"> </span><span class="nn">android.graphics.Color</span><span class="p">;</span>
</span><span id="__span-23-17"><a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a>
</span><span id="__span-23-18"><a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.json.JSONObject</span><span class="p">;</span>
</span><span id="__span-23-19"><a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a>
</span><span id="__span-23-20"><a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">InterstitialView</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">FrameLayout</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-21"><a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">FrameLayout</span><span class="w"> </span><span class="n">contentView</span><span class="p">;</span>
</span><span id="__span-23-22"><a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">WebView</span><span class="w"> </span><span class="n">webView</span><span class="p">;</span>
</span><span id="__span-23-23"><a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ProgressBar</span><span class="w"> </span><span class="n">activityIndicator</span><span class="p">;</span>
</span><span id="__span-23-24"><a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Button</span><span class="w"> </span><span class="n">closeButton</span><span class="p">;</span>
</span><span id="__span-23-25"><a id="__codelineno-23-25" name="__codelineno-23-25" href="#__codelineno-23-25"></a>
</span><span id="__span-23-26"><a id="__codelineno-23-26" name="__codelineno-23-26" href="#__codelineno-23-26"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Activity</span><span class="w"> </span><span class="n">contextActivity</span><span class="p">;</span>
</span><span id="__span-23-27"><a id="__codelineno-23-27" name="__codelineno-23-27" href="#__codelineno-23-27"></a>
</span><span id="__span-23-28"><a id="__codelineno-23-28" name="__codelineno-23-28" href="#__codelineno-23-28"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">InterstitialView</span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-29"><a id="__codelineno-23-29" name="__codelineno-23-29" href="#__codelineno-23-29"></a><span class="w">        </span><span class="kd">super</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
</span><span id="__span-23-30"><a id="__codelineno-23-30" name="__codelineno-23-30" href="#__codelineno-23-30"></a><span class="w">        </span><span class="n">initializeViews</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
</span><span id="__span-23-31"><a id="__codelineno-23-31" name="__codelineno-23-31" href="#__codelineno-23-31"></a><span class="w">        </span><span class="n">setupWebView</span><span class="p">();</span>
</span><span id="__span-23-32"><a id="__codelineno-23-32" name="__codelineno-23-32" href="#__codelineno-23-32"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-23-33"><a id="__codelineno-23-33" name="__codelineno-23-33" href="#__codelineno-23-33"></a>
</span><span id="__span-23-34"><a id="__codelineno-23-34" name="__codelineno-23-34" href="#__codelineno-23-34"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">initializeViews</span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-35"><a id="__codelineno-23-35" name="__codelineno-23-35" href="#__codelineno-23-35"></a><span class="w">        </span><span class="n">setBackgroundColor</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="na">parseColor</span><span class="p">(</span><span class="s">&quot;#99000000&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">// Semi-transparent</span>
</span><span id="__span-23-36"><a id="__codelineno-23-36" name="__codelineno-23-36" href="#__codelineno-23-36"></a><span class="w">        </span><span class="n">setLayoutParams</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">FrameLayout</span><span class="p">.</span><span class="na">LayoutParams</span><span class="p">(</span><span class="n">ViewGroup</span><span class="p">.</span><span class="na">LayoutParams</span><span class="p">.</span><span class="na">MATCH_PARENT</span><span class="p">,</span><span class="w"> </span><span class="n">ViewGroup</span><span class="p">.</span><span class="na">LayoutParams</span><span class="p">.</span><span class="na">MATCH_PARENT</span><span class="p">));</span>
</span><span id="__span-23-37"><a id="__codelineno-23-37" name="__codelineno-23-37" href="#__codelineno-23-37"></a>
</span><span id="__span-23-38"><a id="__codelineno-23-38" name="__codelineno-23-38" href="#__codelineno-23-38"></a><span class="w">        </span><span class="c1">// Content view</span>
</span><span id="__span-23-39"><a id="__codelineno-23-39" name="__codelineno-23-39" href="#__codelineno-23-39"></a><span class="w">        </span><span class="n">contentView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FrameLayout</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
</span><span id="__span-23-40"><a id="__codelineno-23-40" name="__codelineno-23-40" href="#__codelineno-23-40"></a><span class="w">        </span><span class="n">contentView</span><span class="p">.</span><span class="na">setBackgroundColor</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="na">TRANSPARENT</span><span class="p">);</span>
</span><span id="__span-23-41"><a id="__codelineno-23-41" name="__codelineno-23-41" href="#__codelineno-23-41"></a><span class="w">        </span><span class="n">contentView</span><span class="p">.</span><span class="na">setElevation</span><span class="p">(</span><span class="mi">10</span><span class="n">f</span><span class="p">);</span>
</span><span id="__span-23-42"><a id="__codelineno-23-42" name="__codelineno-23-42" href="#__codelineno-23-42"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">contentViewWidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">getResources</span><span class="p">().</span><span class="na">getDisplayMetrics</span><span class="p">().</span><span class="na">widthPixels</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.9</span><span class="p">);</span>
</span><span id="__span-23-43"><a id="__codelineno-23-43" name="__codelineno-23-43" href="#__codelineno-23-43"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">contentViewHeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">getResources</span><span class="p">().</span><span class="na">getDisplayMetrics</span><span class="p">().</span><span class="na">heightPixels</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.8</span><span class="p">);</span>
</span><span id="__span-23-44"><a id="__codelineno-23-44" name="__codelineno-23-44" href="#__codelineno-23-44"></a><span class="w">        </span><span class="n">LayoutParams</span><span class="w"> </span><span class="n">contentViewParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LayoutParams</span><span class="p">(</span><span class="n">contentViewWidth</span><span class="p">,</span><span class="w"> </span><span class="n">contentViewHeight</span><span class="p">);</span>
</span><span id="__span-23-45"><a id="__codelineno-23-45" name="__codelineno-23-45" href="#__codelineno-23-45"></a><span class="w">        </span><span class="n">contentViewParams</span><span class="p">.</span><span class="na">gravity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Gravity</span><span class="p">.</span><span class="na">CENTER</span><span class="p">;</span>
</span><span id="__span-23-46"><a id="__codelineno-23-46" name="__codelineno-23-46" href="#__codelineno-23-46"></a><span class="w">        </span><span class="n">contentView</span><span class="p">.</span><span class="na">setLayoutParams</span><span class="p">(</span><span class="n">contentViewParams</span><span class="p">);</span>
</span><span id="__span-23-47"><a id="__codelineno-23-47" name="__codelineno-23-47" href="#__codelineno-23-47"></a><span class="w">        </span><span class="n">addView</span><span class="p">(</span><span class="n">contentView</span><span class="p">);</span>
</span><span id="__span-23-48"><a id="__codelineno-23-48" name="__codelineno-23-48" href="#__codelineno-23-48"></a>
</span><span id="__span-23-49"><a id="__codelineno-23-49" name="__codelineno-23-49" href="#__codelineno-23-49"></a><span class="w">        </span><span class="c1">// Setting rounded corners for the contentView</span>
</span><span id="__span-23-50"><a id="__codelineno-23-50" name="__codelineno-23-50" href="#__codelineno-23-50"></a><span class="w">        </span><span class="n">contentView</span><span class="p">.</span><span class="na">setClipToOutline</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</span><span id="__span-23-51"><a id="__codelineno-23-51" name="__codelineno-23-51" href="#__codelineno-23-51"></a><span class="w">        </span><span class="n">contentView</span><span class="p">.</span><span class="na">setOutlineProvider</span><span class="p">(</span><span class="n">ViewOutlineProvider</span><span class="p">.</span><span class="na">BACKGROUND</span><span class="p">);</span>
</span><span id="__span-23-52"><a id="__codelineno-23-52" name="__codelineno-23-52" href="#__codelineno-23-52"></a><span class="w">        </span><span class="kt">float</span><span class="o">[]</span><span class="w"> </span><span class="n">radii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">float</span><span class="o">[]</span><span class="p">{</span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">};</span><span class="w"> </span><span class="c1">// radii for each corner in dp</span>
</span><span id="__span-23-53"><a id="__codelineno-23-53" name="__codelineno-23-53" href="#__codelineno-23-53"></a><span class="w">        </span><span class="n">ShapeDrawable</span><span class="w"> </span><span class="n">background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ShapeDrawable</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">RoundRectShape</span><span class="p">(</span><span class="n">radii</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">));</span>
</span><span id="__span-23-54"><a id="__codelineno-23-54" name="__codelineno-23-54" href="#__codelineno-23-54"></a><span class="w">        </span><span class="n">background</span><span class="p">.</span><span class="na">getPaint</span><span class="p">().</span><span class="na">setColor</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="na">WHITE</span><span class="p">);</span>
</span><span id="__span-23-55"><a id="__codelineno-23-55" name="__codelineno-23-55" href="#__codelineno-23-55"></a><span class="w">        </span><span class="n">contentView</span><span class="p">.</span><span class="na">setBackground</span><span class="p">(</span><span class="n">background</span><span class="p">);</span>
</span><span id="__span-23-56"><a id="__codelineno-23-56" name="__codelineno-23-56" href="#__codelineno-23-56"></a>
</span><span id="__span-23-57"><a id="__codelineno-23-57" name="__codelineno-23-57" href="#__codelineno-23-57"></a><span class="w">        </span><span class="c1">// WebView setup</span>
</span><span id="__span-23-58"><a id="__codelineno-23-58" name="__codelineno-23-58" href="#__codelineno-23-58"></a><span class="w">        </span><span class="n">webView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WebView</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
</span><span id="__span-23-59"><a id="__codelineno-23-59" name="__codelineno-23-59" href="#__codelineno-23-59"></a><span class="w">        </span><span class="n">LayoutParams</span><span class="w"> </span><span class="n">webViewParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LayoutParams</span><span class="p">(</span><span class="n">ViewGroup</span><span class="p">.</span><span class="na">LayoutParams</span><span class="p">.</span><span class="na">MATCH_PARENT</span><span class="p">,</span><span class="w"> </span><span class="n">ViewGroup</span><span class="p">.</span><span class="na">LayoutParams</span><span class="p">.</span><span class="na">MATCH_PARENT</span><span class="p">,</span><span class="w"> </span><span class="n">Gravity</span><span class="p">.</span><span class="na">CENTER</span><span class="p">);</span>
</span><span id="__span-23-60"><a id="__codelineno-23-60" name="__codelineno-23-60" href="#__codelineno-23-60"></a><span class="w">        </span><span class="n">webView</span><span class="p">.</span><span class="na">setLayoutParams</span><span class="p">(</span><span class="n">webViewParams</span><span class="p">);</span>
</span><span id="__span-23-61"><a id="__codelineno-23-61" name="__codelineno-23-61" href="#__codelineno-23-61"></a><span class="w">        </span><span class="n">contentView</span><span class="p">.</span><span class="na">addView</span><span class="p">(</span><span class="n">webView</span><span class="p">);</span>
</span><span id="__span-23-62"><a id="__codelineno-23-62" name="__codelineno-23-62" href="#__codelineno-23-62"></a>
</span><span id="__span-23-63"><a id="__codelineno-23-63" name="__codelineno-23-63" href="#__codelineno-23-63"></a><span class="w">        </span><span class="c1">// Activity Indicator</span>
</span><span id="__span-23-64"><a id="__codelineno-23-64" name="__codelineno-23-64" href="#__codelineno-23-64"></a><span class="w">        </span><span class="n">activityIndicator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ProgressBar</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
</span><span id="__span-23-65"><a id="__codelineno-23-65" name="__codelineno-23-65" href="#__codelineno-23-65"></a><span class="w">        </span><span class="n">activityIndicator</span><span class="p">.</span><span class="na">setLayoutParams</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">LayoutParams</span><span class="p">(</span><span class="n">ViewGroup</span><span class="p">.</span><span class="na">LayoutParams</span><span class="p">.</span><span class="na">WRAP_CONTENT</span><span class="p">,</span><span class="w"> </span><span class="n">ViewGroup</span><span class="p">.</span><span class="na">LayoutParams</span><span class="p">.</span><span class="na">WRAP_CONTENT</span><span class="p">,</span><span class="w"> </span><span class="n">Gravity</span><span class="p">.</span><span class="na">CENTER</span><span class="p">));</span>
</span><span id="__span-23-66"><a id="__codelineno-23-66" name="__codelineno-23-66" href="#__codelineno-23-66"></a><span class="w">        </span><span class="n">contentView</span><span class="p">.</span><span class="na">addView</span><span class="p">(</span><span class="n">activityIndicator</span><span class="p">);</span>
</span><span id="__span-23-67"><a id="__codelineno-23-67" name="__codelineno-23-67" href="#__codelineno-23-67"></a>
</span><span id="__span-23-68"><a id="__codelineno-23-68" name="__codelineno-23-68" href="#__codelineno-23-68"></a><span class="w">        </span><span class="c1">// Close button</span>
</span><span id="__span-23-69"><a id="__codelineno-23-69" name="__codelineno-23-69" href="#__codelineno-23-69"></a><span class="w">        </span><span class="n">closeButton</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Button</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
</span><span id="__span-23-70"><a id="__codelineno-23-70" name="__codelineno-23-70" href="#__codelineno-23-70"></a><span class="w">        </span><span class="n">closeButton</span><span class="p">.</span><span class="na">setText</span><span class="p">(</span><span class="s">&quot;X&quot;</span><span class="p">);</span>
</span><span id="__span-23-71"><a id="__codelineno-23-71" name="__codelineno-23-71" href="#__codelineno-23-71"></a><span class="w">        </span><span class="n">closeButton</span><span class="p">.</span><span class="na">setTextColor</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="na">BLACK</span><span class="p">);</span>
</span><span id="__span-23-72"><a id="__codelineno-23-72" name="__codelineno-23-72" href="#__codelineno-23-72"></a><span class="w">        </span><span class="n">closeButton</span><span class="p">.</span><span class="na">setBackground</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span><span class="w"> </span><span class="c1">// Removing default background to make it less obtrusive</span>
</span><span id="__span-23-73"><a id="__codelineno-23-73" name="__codelineno-23-73" href="#__codelineno-23-73"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">buttonSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="mi">25</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">getResources</span><span class="p">().</span><span class="na">getDisplayMetrics</span><span class="p">().</span><span class="na">density</span><span class="p">);</span><span class="w"> </span><span class="c1">// 25dp to pixels</span>
</span><span id="__span-23-74"><a id="__codelineno-23-74" name="__codelineno-23-74" href="#__codelineno-23-74"></a><span class="w">        </span><span class="n">LayoutParams</span><span class="w"> </span><span class="n">closeButtonParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LayoutParams</span><span class="p">(</span><span class="n">buttonSize</span><span class="p">,</span><span class="w"> </span><span class="n">buttonSize</span><span class="p">);</span>
</span><span id="__span-23-75"><a id="__codelineno-23-75" name="__codelineno-23-75" href="#__codelineno-23-75"></a><span class="w">        </span><span class="n">closeButtonParams</span><span class="p">.</span><span class="na">gravity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Gravity</span><span class="p">.</span><span class="na">TOP</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Gravity</span><span class="p">.</span><span class="na">END</span><span class="p">;</span>
</span><span id="__span-23-76"><a id="__codelineno-23-76" name="__codelineno-23-76" href="#__codelineno-23-76"></a><span class="w">        </span><span class="n">closeButton</span><span class="p">.</span><span class="na">setLayoutParams</span><span class="p">(</span><span class="n">closeButtonParams</span><span class="p">);</span>
</span><span id="__span-23-77"><a id="__codelineno-23-77" name="__codelineno-23-77" href="#__codelineno-23-77"></a><span class="w">        </span><span class="n">closeButton</span><span class="p">.</span><span class="na">setPadding</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span><span class="w"> </span><span class="c1">// Padding in pixels</span>
</span><span id="__span-23-78"><a id="__codelineno-23-78" name="__codelineno-23-78" href="#__codelineno-23-78"></a><span class="w">        </span><span class="n">closeButton</span><span class="p">.</span><span class="na">setOnClickListener</span><span class="p">(</span><span class="n">v</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">cancelAndDismiss</span><span class="p">());</span>
</span><span id="__span-23-79"><a id="__codelineno-23-79" name="__codelineno-23-79" href="#__codelineno-23-79"></a><span class="w">        </span><span class="n">contentView</span><span class="p">.</span><span class="na">addView</span><span class="p">(</span><span class="n">closeButton</span><span class="p">);</span><span class="w"> </span><span class="c1">// Adding the button to contentView so it&#39;s inside the WebView</span>
</span><span id="__span-23-80"><a id="__codelineno-23-80" name="__codelineno-23-80" href="#__codelineno-23-80"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-23-81"><a id="__codelineno-23-81" name="__codelineno-23-81" href="#__codelineno-23-81"></a>
</span><span id="__span-23-82"><a id="__codelineno-23-82" name="__codelineno-23-82" href="#__codelineno-23-82"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setupWebView</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-83"><a id="__codelineno-23-83" name="__codelineno-23-83" href="#__codelineno-23-83"></a><span class="w">        </span><span class="n">webView</span><span class="p">.</span><span class="na">setWebViewClient</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">WebViewClient</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-84"><a id="__codelineno-23-84" name="__codelineno-23-84" href="#__codelineno-23-84"></a><span class="w">            </span><span class="nd">@Override</span>
</span><span id="__span-23-85"><a id="__codelineno-23-85" name="__codelineno-23-85" href="#__codelineno-23-85"></a><span class="w">            </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onPageFinished</span><span class="p">(</span><span class="n">WebView</span><span class="w"> </span><span class="n">view</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">url</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-86"><a id="__codelineno-23-86" name="__codelineno-23-86" href="#__codelineno-23-86"></a><span class="w">                </span><span class="n">activityIndicator</span><span class="p">.</span><span class="na">setVisibility</span><span class="p">(</span><span class="n">GONE</span><span class="p">);</span>
</span><span id="__span-23-87"><a id="__codelineno-23-87" name="__codelineno-23-87" href="#__codelineno-23-87"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-23-88"><a id="__codelineno-23-88" name="__codelineno-23-88" href="#__codelineno-23-88"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-23-89"><a id="__codelineno-23-89" name="__codelineno-23-89" href="#__codelineno-23-89"></a>
</span><span id="__span-23-90"><a id="__codelineno-23-90" name="__codelineno-23-90" href="#__codelineno-23-90"></a><span class="w">        </span><span class="c1">// Enable JavaScript</span>
</span><span id="__span-23-91"><a id="__codelineno-23-91" name="__codelineno-23-91" href="#__codelineno-23-91"></a><span class="w">        </span><span class="n">webView</span><span class="p">.</span><span class="na">getSettings</span><span class="p">().</span><span class="na">setJavaScriptEnabled</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</span><span id="__span-23-92"><a id="__codelineno-23-92" name="__codelineno-23-92" href="#__codelineno-23-92"></a><span class="w">        </span><span class="n">webView</span><span class="p">.</span><span class="na">addJavascriptInterface</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-93"><a id="__codelineno-23-93" name="__codelineno-23-93" href="#__codelineno-23-93"></a><span class="w">            </span><span class="nd">@JavascriptInterface</span>
</span><span id="__span-23-94"><a id="__codelineno-23-94" name="__codelineno-23-94" href="#__codelineno-23-94"></a><span class="w">            </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">postMessage</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-95"><a id="__codelineno-23-95" name="__codelineno-23-95" href="#__codelineno-23-95"></a><span class="w">                </span><span class="n">JSONObject</span><span class="w"> </span><span class="n">messageData</span><span class="p">;</span>
</span><span id="__span-23-96"><a id="__codelineno-23-96" name="__codelineno-23-96" href="#__codelineno-23-96"></a><span class="w">                </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-97"><a id="__codelineno-23-97" name="__codelineno-23-97" href="#__codelineno-23-97"></a><span class="w">                    </span><span class="n">messageData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JSONObject</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
</span><span id="__span-23-98"><a id="__codelineno-23-98" name="__codelineno-23-98" href="#__codelineno-23-98"></a><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-99"><a id="__codelineno-23-99" name="__codelineno-23-99" href="#__codelineno-23-99"></a><span class="w">                    </span><span class="c1">// This should never happen, but just in case, handle parsing errors here</span>
</span><span id="__span-23-100"><a id="__codelineno-23-100" name="__codelineno-23-100" href="#__codelineno-23-100"></a><span class="w">                    </span><span class="n">cancelAndDismiss</span><span class="p">();</span>
</span><span id="__span-23-101"><a id="__codelineno-23-101" name="__codelineno-23-101" href="#__codelineno-23-101"></a><span class="w">                    </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-23-102"><a id="__codelineno-23-102" name="__codelineno-23-102" href="#__codelineno-23-102"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-23-103"><a id="__codelineno-23-103" name="__codelineno-23-103" href="#__codelineno-23-103"></a>
</span><span id="__span-23-104"><a id="__codelineno-23-104" name="__codelineno-23-104" href="#__codelineno-23-104"></a><span class="w">                </span><span class="n">String</span><span class="w"> </span><span class="n">clickUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">messageData</span><span class="p">.</span><span class="na">optString</span><span class="p">(</span><span class="s">&quot;clickUrl&quot;</span><span class="p">);</span>
</span><span id="__span-23-105"><a id="__codelineno-23-105" name="__codelineno-23-105" href="#__codelineno-23-105"></a>
</span><span id="__span-23-106"><a id="__codelineno-23-106" name="__codelineno-23-106" href="#__codelineno-23-106"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">clickUrl</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">clickUrl</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-107"><a id="__codelineno-23-107" name="__codelineno-23-107" href="#__codelineno-23-107"></a><span class="w">                    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-108"><a id="__codelineno-23-108" name="__codelineno-23-108" href="#__codelineno-23-108"></a><span class="w">                        </span><span class="n">Intent</span><span class="w"> </span><span class="n">browserIntent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Intent</span><span class="p">(</span><span class="n">Intent</span><span class="p">.</span><span class="na">ACTION_VIEW</span><span class="p">,</span><span class="w"> </span><span class="n">Uri</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="n">clickUrl</span><span class="p">));</span>
</span><span id="__span-23-109"><a id="__codelineno-23-109" name="__codelineno-23-109" href="#__codelineno-23-109"></a><span class="w">                        </span><span class="n">browserIntent</span><span class="p">.</span><span class="na">addFlags</span><span class="p">(</span><span class="n">Intent</span><span class="p">.</span><span class="na">FLAG_ACTIVITY_NEW_TASK</span><span class="p">);</span>
</span><span id="__span-23-110"><a id="__codelineno-23-110" name="__codelineno-23-110" href="#__codelineno-23-110"></a><span class="w">                        </span><span class="n">getContext</span><span class="p">().</span><span class="na">startActivity</span><span class="p">(</span><span class="n">browserIntent</span><span class="p">);</span>
</span><span id="__span-23-111"><a id="__codelineno-23-111" name="__codelineno-23-111" href="#__codelineno-23-111"></a><span class="w">                    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-112"><a id="__codelineno-23-112" name="__codelineno-23-112" href="#__codelineno-23-112"></a><span class="w">                        </span><span class="c1">// This will trigger in case there are no offers available for whatever reason</span>
</span><span id="__span-23-113"><a id="__codelineno-23-113" name="__codelineno-23-113" href="#__codelineno-23-113"></a><span class="w">                        </span><span class="n">cancelAndDismiss</span><span class="p">();</span>
</span><span id="__span-23-114"><a id="__codelineno-23-114" name="__codelineno-23-114" href="#__codelineno-23-114"></a><span class="w">                        </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-23-115"><a id="__codelineno-23-115" name="__codelineno-23-115" href="#__codelineno-23-115"></a><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-23-116"><a id="__codelineno-23-116" name="__codelineno-23-116" href="#__codelineno-23-116"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-23-117"><a id="__codelineno-23-117" name="__codelineno-23-117" href="#__codelineno-23-117"></a>
</span><span id="__span-23-118"><a id="__codelineno-23-118" name="__codelineno-23-118" href="#__codelineno-23-118"></a><span class="w">                </span><span class="c1">// Dismiss the webview</span>
</span><span id="__span-23-119"><a id="__codelineno-23-119" name="__codelineno-23-119" href="#__codelineno-23-119"></a><span class="w">                </span><span class="n">dismiss</span><span class="p">();</span>
</span><span id="__span-23-120"><a id="__codelineno-23-120" name="__codelineno-23-120" href="#__codelineno-23-120"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-23-121"><a id="__codelineno-23-121" name="__codelineno-23-121" href="#__codelineno-23-121"></a><span class="w">        </span><span class="p">},</span><span class="w"> </span><span class="s">&quot;AtarInterface&quot;</span><span class="p">);</span>
</span><span id="__span-23-122"><a id="__codelineno-23-122" name="__codelineno-23-122" href="#__codelineno-23-122"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-23-123"><a id="__codelineno-23-123" name="__codelineno-23-123" href="#__codelineno-23-123"></a>
</span><span id="__span-23-124"><a id="__codelineno-23-124" name="__codelineno-23-124" href="#__codelineno-23-124"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">loadUrl</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">url</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-125"><a id="__codelineno-23-125" name="__codelineno-23-125" href="#__codelineno-23-125"></a><span class="w">        </span><span class="n">Logger</span><span class="p">.</span><span class="na">getInstance</span><span class="p">().</span><span class="na">i</span><span class="p">(</span><span class="s">&quot;InterstitialView: Loading URL: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">url</span><span class="p">);</span>
</span><span id="__span-23-126"><a id="__codelineno-23-126" name="__codelineno-23-126" href="#__codelineno-23-126"></a><span class="w">        </span><span class="n">webView</span><span class="p">.</span><span class="na">loadUrl</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>
</span><span id="__span-23-127"><a id="__codelineno-23-127" name="__codelineno-23-127" href="#__codelineno-23-127"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-23-128"><a id="__codelineno-23-128" name="__codelineno-23-128" href="#__codelineno-23-128"></a>
</span><span id="__span-23-129"><a id="__codelineno-23-129" name="__codelineno-23-129" href="#__codelineno-23-129"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">show</span><span class="p">(</span><span class="n">Activity</span><span class="w"> </span><span class="n">activity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-130"><a id="__codelineno-23-130" name="__codelineno-23-130" href="#__codelineno-23-130"></a><span class="w">        </span><span class="n">ViewGroup</span><span class="w"> </span><span class="n">decorView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ViewGroup</span><span class="p">)</span><span class="w"> </span><span class="n">activity</span><span class="p">.</span><span class="na">getWindow</span><span class="p">().</span><span class="na">getDecorView</span><span class="p">();</span>
</span><span id="__span-23-131"><a id="__codelineno-23-131" name="__codelineno-23-131" href="#__codelineno-23-131"></a><span class="w">        </span><span class="n">decorView</span><span class="p">.</span><span class="na">addView</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span><span id="__span-23-132"><a id="__codelineno-23-132" name="__codelineno-23-132" href="#__codelineno-23-132"></a><span class="w">        </span><span class="n">setAlpha</span><span class="p">(</span><span class="mf">0f</span><span class="p">);</span>
</span><span id="__span-23-133"><a id="__codelineno-23-133" name="__codelineno-23-133" href="#__codelineno-23-133"></a><span class="w">        </span><span class="n">animate</span><span class="p">().</span><span class="na">alpha</span><span class="p">(</span><span class="mf">1f</span><span class="p">).</span><span class="na">setDuration</span><span class="p">(</span><span class="mi">300</span><span class="p">).</span><span class="na">start</span><span class="p">();</span>
</span><span id="__span-23-134"><a id="__codelineno-23-134" name="__codelineno-23-134" href="#__codelineno-23-134"></a><span class="w">        </span><span class="n">contextActivity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">activity</span><span class="p">;</span>
</span><span id="__span-23-135"><a id="__codelineno-23-135" name="__codelineno-23-135" href="#__codelineno-23-135"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-23-136"><a id="__codelineno-23-136" name="__codelineno-23-136" href="#__codelineno-23-136"></a>
</span><span id="__span-23-137"><a id="__codelineno-23-137" name="__codelineno-23-137" href="#__codelineno-23-137"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">cancelAndDismiss</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-138"><a id="__codelineno-23-138" name="__codelineno-23-138" href="#__codelineno-23-138"></a><span class="w">        </span><span class="c1">// Implement any custom logic for when the user cancels</span>
</span><span id="__span-23-139"><a id="__codelineno-23-139" name="__codelineno-23-139" href="#__codelineno-23-139"></a><span class="w">        </span><span class="n">dismiss</span><span class="p">();</span>
</span><span id="__span-23-140"><a id="__codelineno-23-140" name="__codelineno-23-140" href="#__codelineno-23-140"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-23-141"><a id="__codelineno-23-141" name="__codelineno-23-141" href="#__codelineno-23-141"></a>
</span><span id="__span-23-142"><a id="__codelineno-23-142" name="__codelineno-23-142" href="#__codelineno-23-142"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">dismiss</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-143"><a id="__codelineno-23-143" name="__codelineno-23-143" href="#__codelineno-23-143"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">contextActivity</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-144"><a id="__codelineno-23-144" name="__codelineno-23-144" href="#__codelineno-23-144"></a><span class="w">            </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-23-145"><a id="__codelineno-23-145" name="__codelineno-23-145" href="#__codelineno-23-145"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-23-146"><a id="__codelineno-23-146" name="__codelineno-23-146" href="#__codelineno-23-146"></a><span class="w">        </span><span class="n">contextActivity</span><span class="p">.</span><span class="na">runOnUiThread</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">animate</span><span class="p">().</span><span class="na">alpha</span><span class="p">(</span><span class="mf">0f</span><span class="p">).</span><span class="na">setDuration</span><span class="p">(</span><span class="mi">300</span><span class="p">).</span><span class="na">withEndAction</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">((</span><span class="n">ViewGroup</span><span class="p">)</span><span class="w"> </span><span class="n">getParent</span><span class="p">()).</span><span class="na">removeView</span><span class="p">(</span><span class="k">this</span><span class="p">)).</span><span class="na">start</span><span class="p">());</span>
</span><span id="__span-23-147"><a id="__codelineno-23-147" name="__codelineno-23-147" href="#__codelineno-23-147"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-23-148"><a id="__codelineno-23-148" name="__codelineno-23-148" href="#__codelineno-23-148"></a><span class="p">}</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="k">import</span><span class="w"> </span><span class="nn">android.app.Activity</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="k">import</span><span class="w"> </span><span class="nn">android.content.Context</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="k">import</span><span class="w"> </span><span class="nn">android.content.Intent</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="k">import</span><span class="w"> </span><span class="nn">android.graphics.Color</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="k">import</span><span class="w"> </span><span class="nn">android.graphics.Outline</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="k">import</span><span class="w"> </span><span class="nn">android.graphics.Rect</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="k">import</span><span class="w"> </span><span class="nn">android.os.Build</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="k">import</span><span class="w"> </span><span class="nn">android.view.View</span>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="k">import</span><span class="w"> </span><span class="nn">android.view.ViewGroup</span>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="k">import</span><span class="w"> </span><span class="nn">android.view.ViewOutlineProvider</span>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="k">import</span><span class="w"> </span><span class="nn">android.webkit.JavascriptInterface</span>
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a><span class="k">import</span><span class="w"> </span><span class="nn">android.webkit.WebView</span>
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a><span class="k">import</span><span class="w"> </span><span class="nn">android.webkit.WebViewClient</span>
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a><span class="k">import</span><span class="w"> </span><span class="nn">android.widget.Button</span>
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a><span class="k">import</span><span class="w"> </span><span class="nn">android.widget.FrameLayout</span>
</span><span id="__span-24-16"><a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a><span class="k">import</span><span class="w"> </span><span class="nn">android.widget.ProgressBar</span>
</span><span id="__span-24-17"><a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a><span class="k">import</span><span class="w"> </span><span class="nn">androidx.annotation.RequiresApi</span>
</span><span id="__span-24-18"><a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a>
</span><span id="__span-24-19"><a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a><span class="k">import</span><span class="w"> </span><span class="nn">org.json.JSONObject</span>
</span><span id="__span-24-20"><a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a>
</span><span id="__span-24-21"><a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a><span class="kd">class</span><span class="w"> </span><span class="nc">InterstitialView</span><span class="p">(</span><span class="n">context</span><span class="p">:</span><span class="w"> </span><span class="n">Context</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">FrameLayout</span><span class="p">(</span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-22"><a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">contentView</span><span class="p">:</span><span class="w"> </span><span class="n">FrameLayout</span>
</span><span id="__span-24-23"><a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">webView</span><span class="p">:</span><span class="w"> </span><span class="n">WebView</span>
</span><span id="__span-24-24"><a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">activityIndicator</span><span class="p">:</span><span class="w"> </span><span class="n">ProgressBar</span>
</span><span id="__span-24-25"><a id="__codelineno-24-25" name="__codelineno-24-25" href="#__codelineno-24-25"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">closeButton</span><span class="p">:</span><span class="w"> </span><span class="n">Button</span>
</span><span id="__span-24-26"><a id="__codelineno-24-26" name="__codelineno-24-26" href="#__codelineno-24-26"></a>
</span><span id="__span-24-27"><a id="__codelineno-24-27" name="__codelineno-24-27" href="#__codelineno-24-27"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nv">contextActivity</span><span class="p">:</span><span class="w"> </span><span class="n">Activity? </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
</span><span id="__span-24-28"><a id="__codelineno-24-28" name="__codelineno-24-28" href="#__codelineno-24-28"></a>
</span><span id="__span-24-29"><a id="__codelineno-24-29" name="__codelineno-24-29" href="#__codelineno-24-29"></a><span class="w">    </span><span class="k">init</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-30"><a id="__codelineno-24-30" name="__codelineno-24-30" href="#__codelineno-24-30"></a><span class="w">        </span><span class="n">setBackgroundColor</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="na">parseColor</span><span class="p">(</span><span class="s">&quot;#99000000&quot;</span><span class="p">))</span><span class="w"> </span><span class="c1">// Semi-transparent</span>
</span><span id="__span-24-31"><a id="__codelineno-24-31" name="__codelineno-24-31" href="#__codelineno-24-31"></a><span class="w">        </span><span class="n">layoutParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LayoutParams</span><span class="p">(</span><span class="n">ViewGroup</span><span class="p">.</span><span class="na">LayoutParams</span><span class="p">.</span><span class="na">MATCH_PARENT</span><span class="p">,</span><span class="w"> </span><span class="n">ViewGroup</span><span class="p">.</span><span class="na">LayoutParams</span><span class="p">.</span><span class="na">MATCH_PARENT</span><span class="p">)</span>
</span><span id="__span-24-32"><a id="__codelineno-24-32" name="__codelineno-24-32" href="#__codelineno-24-32"></a>
</span><span id="__span-24-33"><a id="__codelineno-24-33" name="__codelineno-24-33" href="#__codelineno-24-33"></a><span class="w">        </span><span class="c1">// Content view</span>
</span><span id="__span-24-34"><a id="__codelineno-24-34" name="__codelineno-24-34" href="#__codelineno-24-34"></a><span class="w">        </span><span class="n">contentView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FrameLayout</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</span><span id="__span-24-35"><a id="__codelineno-24-35" name="__codelineno-24-35" href="#__codelineno-24-35"></a><span class="w">        </span><span class="n">contentView</span><span class="p">.</span><span class="na">setBackgroundColor</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="na">TRANSPARENT</span><span class="p">)</span>
</span><span id="__span-24-36"><a id="__codelineno-24-36" name="__codelineno-24-36" href="#__codelineno-24-36"></a><span class="w">        </span><span class="n">contentView</span><span class="p">.</span><span class="na">elevation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10f</span>
</span><span id="__span-24-37"><a id="__codelineno-24-37" name="__codelineno-24-37" href="#__codelineno-24-37"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">contentViewWidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">resources</span><span class="p">.</span><span class="na">displayMetrics</span><span class="p">.</span><span class="na">widthPixels</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">0.9</span><span class="p">).</span><span class="na">toInt</span><span class="p">()</span>
</span><span id="__span-24-38"><a id="__codelineno-24-38" name="__codelineno-24-38" href="#__codelineno-24-38"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">contentViewHeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">resources</span><span class="p">.</span><span class="na">displayMetrics</span><span class="p">.</span><span class="na">heightPixels</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">0.8</span><span class="p">).</span><span class="na">toInt</span><span class="p">()</span>
</span><span id="__span-24-39"><a id="__codelineno-24-39" name="__codelineno-24-39" href="#__codelineno-24-39"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">contentViewParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LayoutParams</span><span class="p">(</span><span class="n">contentViewWidth</span><span class="p">,</span><span class="w"> </span><span class="n">contentViewHeight</span><span class="p">)</span>
</span><span id="__span-24-40"><a id="__codelineno-24-40" name="__codelineno-24-40" href="#__codelineno-24-40"></a><span class="w">        </span><span class="n">contentViewParams</span><span class="p">.</span><span class="na">gravity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Gravity</span><span class="p">.</span><span class="na">CENTER</span>
</span><span id="__span-24-41"><a id="__codelineno-24-41" name="__codelineno-24-41" href="#__codelineno-24-41"></a><span class="w">        </span><span class="n">contentView</span><span class="p">.</span><span class="na">layoutParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">contentViewParams</span>
</span><span id="__span-24-42"><a id="__codelineno-24-42" name="__codelineno-24-42" href="#__codelineno-24-42"></a><span class="w">        </span><span class="n">addView</span><span class="p">(</span><span class="n">contentView</span><span class="p">)</span>
</span><span id="__span-24-43"><a id="__codelineno-24-43" name="__codelineno-24-43" href="#__codelineno-24-43"></a>
</span><span id="__span-24-44"><a id="__codelineno-24-44" name="__codelineno-24-44" href="#__codelineno-24-44"></a><span class="w">        </span><span class="c1">// Setting rounded corners for the contentView</span>
</span><span id="__span-24-45"><a id="__codelineno-24-45" name="__codelineno-24-45" href="#__codelineno-24-45"></a><span class="w">        </span><span class="n">contentView</span><span class="p">.</span><span class="na">clipToOutline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-24-46"><a id="__codelineno-24-46" name="__codelineno-24-46" href="#__codelineno-24-46"></a><span class="w">        </span><span class="n">contentView</span><span class="p">.</span><span class="na">outlineProvider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">ViewOutlineProvider</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-47"><a id="__codelineno-24-47" name="__codelineno-24-47" href="#__codelineno-24-47"></a><span class="w">            </span><span class="nd">@RequiresApi</span><span class="p">(</span><span class="n">Build</span><span class="p">.</span><span class="na">VERSION_CODES</span><span class="p">.</span><span class="na">LOLLIPOP</span><span class="p">)</span>
</span><span id="__span-24-48"><a id="__codelineno-24-48" name="__codelineno-24-48" href="#__codelineno-24-48"></a><span class="w">            </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getOutline</span><span class="p">(</span><span class="n">view</span><span class="p">:</span><span class="w"> </span><span class="n">View?,</span><span class="w"> </span><span class="n">outline</span><span class="p">:</span><span class="w"> </span><span class="n">Outline?)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-49"><a id="__codelineno-24-49" name="__codelineno-24-49" href="#__codelineno-24-49"></a><span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">radii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">floatArrayOf</span><span class="p">(</span><span class="m">25f</span><span class="p">,</span><span class="w"> </span><span class="m">25f</span><span class="p">,</span><span class="w"> </span><span class="m">25f</span><span class="p">,</span><span class="w"> </span><span class="m">25f</span><span class="p">,</span><span class="w"> </span><span class="m">25f</span><span class="p">,</span><span class="w"> </span><span class="m">25f</span><span class="p">,</span><span class="w"> </span><span class="m">25f</span><span class="p">,</span><span class="w"> </span><span class="m">25f</span><span class="p">)</span><span class="w"> </span><span class="c1">// radii for each corner in dp</span>
</span><span id="__span-24-50"><a id="__codelineno-24-50" name="__codelineno-24-50" href="#__codelineno-24-50"></a><span class="w">                </span><span class="n">outline</span><span class="o">?.</span><span class="na">setRoundRect</span><span class="p">(</span><span class="n">Rect</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">view</span><span class="o">?.</span><span class="na">width</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">view</span><span class="o">?.</span><span class="na">height</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">radii</span><span class="p">)</span>
</span><span id="__span-24-51"><a id="__codelineno-24-51" name="__codelineno-24-51" href="#__codelineno-24-51"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-24-52"><a id="__codelineno-24-52" name="__codelineno-24-52" href="#__codelineno-24-52"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-24-53"><a id="__codelineno-24-53" name="__codelineno-24-53" href="#__codelineno-24-53"></a>
</span><span id="__span-24-54"><a id="__codelineno-24-54" name="__codelineno-24-54" href="#__codelineno-24-54"></a><span class="w">        </span><span class="c1">// WebView setup</span>
</span><span id="__span-24-55"><a id="__codelineno-24-55" name="__codelineno-24-55" href="#__codelineno-24-55"></a><span class="w">        </span><span class="n">webView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WebView</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</span><span id="__span-24-56"><a id="__codelineno-24-56" name="__codelineno-24-56" href="#__codelineno-24-56"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">webViewParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LayoutParams</span><span class="p">(</span><span class="n">ViewGroup</span><span class="p">.</span><span class="na">LayoutParams</span><span class="p">.</span><span class="na">MATCH_PARENT</span><span class="p">,</span><span class="w"> </span><span class="n">ViewGroup</span><span class="p">.</span><span class="na">LayoutParams</span><span class="p">.</span><span class="na">MATCH_PARENT</span><span class="p">,</span><span class="w"> </span><span class="n">Gravity</span><span class="p">.</span><span class="na">CENTER</span><span class="p">)</span>
</span><span id="__span-24-57"><a id="__codelineno-24-57" name="__codelineno-24-57" href="#__codelineno-24-57"></a><span class="w">        </span><span class="n">webView</span><span class="p">.</span><span class="na">layoutParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">webViewParams</span>
</span><span id="__span-24-58"><a id="__codelineno-24-58" name="__codelineno-24-58" href="#__codelineno-24-58"></a><span class="w">        </span><span class="n">contentView</span><span class="p">.</span><span class="na">addView</span><span class="p">(</span><span class="n">webView</span><span class="p">)</span>
</span><span id="__span-24-59"><a id="__codelineno-24-59" name="__codelineno-24-59" href="#__codelineno-24-59"></a>
</span><span id="__span-24-60"><a id="__codelineno-24-60" name="__codelineno-24-60" href="#__codelineno-24-60"></a><span class="w">        </span><span class="c1">// Activity Indicator</span>
</span><span id="__span-24-61"><a id="__codelineno-24-61" name="__codelineno-24-61" href="#__codelineno-24-61"></a><span class="w">        </span><span class="n">activityIndicator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ProgressBar</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</span><span id="__span-24-62"><a id="__codelineno-24-62" name="__codelineno-24-62" href="#__codelineno-24-62"></a><span class="w">        </span><span class="n">activityIndicator</span><span class="p">.</span><span class="na">layoutParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LayoutParams</span><span class="p">(</span><span class="n">ViewGroup</span><span class="p">.</span><span class="na">LayoutParams</span><span class="p">.</span><span class="na">WRAP_CONTENT</span><span class="p">,</span><span class="w"> </span><span class="n">ViewGroup</span><span class="p">.</span><span class="na">LayoutParams</span><span class="p">.</span><span class="na">WRAP_CONTENT</span><span class="p">,</span><span class="w"> </span><span class="n">Gravity</span><span class="p">.</span><span class="na">CENTER</span><span class="p">)</span>
</span><span id="__span-24-63"><a id="__codelineno-24-63" name="__codelineno-24-63" href="#__codelineno-24-63"></a><span class="w">        </span><span class="n">contentView</span><span class="p">.</span><span class="na">addView</span><span class="p">(</span><span class="n">activityIndicator</span><span class="p">)</span>
</span><span id="__span-24-64"><a id="__codelineno-24-64" name="__codelineno-24-64" href="#__codelineno-24-64"></a>
</span><span id="__span-24-65"><a id="__codelineno-24-65" name="__codelineno-24-65" href="#__codelineno-24-65"></a><span class="w">        </span><span class="c1">// Close button</span>
</span><span id="__span-24-66"><a id="__codelineno-24-66" name="__codelineno-24-66" href="#__codelineno-24-66"></a><span class="w">        </span><span class="n">closeButton</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Button</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</span><span id="__span-24-67"><a id="__codelineno-24-67" name="__codelineno-24-67" href="#__codelineno-24-67"></a><span class="w">        </span><span class="n">closeButton</span><span class="p">.</span><span class="na">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;X&quot;</span>
</span><span id="__span-24-68"><a id="__codelineno-24-68" name="__codelineno-24-68" href="#__codelineno-24-68"></a><span class="w">        </span><span class="n">closeButton</span><span class="p">.</span><span class="na">setTextColor</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="na">BLACK</span><span class="p">)</span>
</span><span id="__span-24-69"><a id="__codelineno-24-69" name="__codelineno-24-69" href="#__codelineno-24-69"></a><span class="w">        </span><span class="n">closeButton</span><span class="p">.</span><span class="na">background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="c1">// Removing default background to make it less obtrusive</span>
</span><span id="__span-24-70"><a id="__codelineno-24-70" name="__codelineno-24-70" href="#__codelineno-24-70"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">buttonSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="m">25</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">resources</span><span class="p">.</span><span class="na">displayMetrics</span><span class="p">.</span><span class="na">density</span><span class="p">).</span><span class="na">toInt</span><span class="p">()</span><span class="w"> </span><span class="c1">// 25dp to pixels</span>
</span><span id="__span-24-71"><a id="__codelineno-24-71" name="__codelineno-24-71" href="#__codelineno-24-71"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">closeButtonParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LayoutParams</span><span class="p">(</span><span class="n">buttonSize</span><span class="p">,</span><span class="w"> </span><span class="n">buttonSize</span><span class="p">)</span>
</span><span id="__span-24-72"><a id="__codelineno-24-72" name="__codelineno-24-72" href="#__codelineno-24-72"></a><span class="w">        </span><span class="n">closeButtonParams</span><span class="p">.</span><span class="na">gravity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Gravity</span><span class="p">.</span><span class="na">TOP</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">Gravity</span><span class="p">.</span><span class="na">END</span>
</span><span id="__span-24-73"><a id="__codelineno-24-73" name="__codelineno-24-73" href="#__codelineno-24-73"></a><span class="w">        </span><span class="n">closeButton</span><span class="p">.</span><span class="na">layoutParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">closeButtonParams</span>
</span><span id="__span-24-74"><a id="__codelineno-24-74" name="__codelineno-24-74" href="#__codelineno-24-74"></a><span class="w">        </span><span class="n">closeButton</span><span class="p">.</span><span class="na">setPadding</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="c1">// Padding in pixels</span>
</span><span id="__span-24-75"><a id="__codelineno-24-75" name="__codelineno-24-75" href="#__codelineno-24-75"></a><span class="w">        </span><span class="n">closeButton</span><span class="p">.</span><span class="na">setOnClickListener</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">cancelAndDismiss</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-24-76"><a id="__codelineno-24-76" name="__codelineno-24-76" href="#__codelineno-24-76"></a><span class="w">        </span><span class="n">contentView</span><span class="p">.</span><span class="na">addView</span><span class="p">(</span><span class="n">closeButton</span><span class="p">)</span><span class="w"> </span><span class="c1">// Adding the button to contentView so it&#39;s inside the WebView</span>
</span><span id="__span-24-77"><a id="__codelineno-24-77" name="__codelineno-24-77" href="#__codelineno-24-77"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-24-78"><a id="__codelineno-24-78" name="__codelineno-24-78" href="#__codelineno-24-78"></a>
</span><span id="__span-24-79"><a id="__codelineno-24-79" name="__codelineno-24-79" href="#__codelineno-24-79"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">setupWebView</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-80"><a id="__codelineno-24-80" name="__codelineno-24-80" href="#__codelineno-24-80"></a><span class="w">        </span><span class="n">webView</span><span class="p">.</span><span class="na">webViewClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">WebViewClient</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-81"><a id="__codelineno-24-81" name="__codelineno-24-81" href="#__codelineno-24-81"></a><span class="w">            </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">onPageFinished</span><span class="p">(</span><span class="n">view</span><span class="p">:</span><span class="w"> </span><span class="n">WebView?,</span><span class="w"> </span><span class="n">url</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-82"><a id="__codelineno-24-82" name="__codelineno-24-82" href="#__codelineno-24-82"></a><span class="w">                </span><span class="n">activityIndicator</span><span class="p">.</span><span class="na">visibility</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GONE</span>
</span><span id="__span-24-83"><a id="__codelineno-24-83" name="__codelineno-24-83" href="#__codelineno-24-83"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-24-84"><a id="__codelineno-24-84" name="__codelineno-24-84" href="#__codelineno-24-84"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-24-85"><a id="__codelineno-24-85" name="__codelineno-24-85" href="#__codelineno-24-85"></a>
</span><span id="__span-24-86"><a id="__codelineno-24-86" name="__codelineno-24-86" href="#__codelineno-24-86"></a><span class="w">        </span><span class="c1">// Enable JavaScript</span>
</span><span id="__span-24-87"><a id="__codelineno-24-87" name="__codelineno-24-87" href="#__codelineno-24-87"></a><span class="w">        </span><span class="n">webView</span><span class="p">.</span><span class="na">settings</span><span class="p">.</span><span class="na">javaScriptEnabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-24-88"><a id="__codelineno-24-88" name="__codelineno-24-88" href="#__codelineno-24-88"></a><span class="w">        </span><span class="n">webView</span><span class="p">.</span><span class="na">addJavascriptInterface</span><span class="p">(</span><span class="kd">object</span><span class="w"> </span><span class="err">{</span>
</span><span id="__span-24-89"><a id="__codelineno-24-89" name="__codelineno-24-89" href="#__codelineno-24-89"></a><span class="w">            </span><span class="nd">@JavascriptInterface</span>
</span><span id="__span-24-90"><a id="__codelineno-24-90" name="__codelineno-24-90" href="#__codelineno-24-90"></a><span class="w">            </span><span class="kd">fun</span><span class="w"> </span><span class="nf">postMessage</span><span class="p">(</span><span class="n">data</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-91"><a id="__codelineno-24-91" name="__codelineno-24-91" href="#__codelineno-24-91"></a><span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">messageData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-92"><a id="__codelineno-24-92" name="__codelineno-24-92" href="#__codelineno-24-92"></a><span class="w">                    </span><span class="n">JSONObject</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-24-93"><a id="__codelineno-24-93" name="__codelineno-24-93" href="#__codelineno-24-93"></a><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">Exception</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-94"><a id="__codelineno-24-94" name="__codelineno-24-94" href="#__codelineno-24-94"></a><span class="w">                    </span><span class="c1">// This should never happen, but just in case, handle parsing errors here</span>
</span><span id="__span-24-95"><a id="__codelineno-24-95" name="__codelineno-24-95" href="#__codelineno-24-95"></a><span class="w">                    </span><span class="n">cancelAndDismiss</span><span class="p">()</span>
</span><span id="__span-24-96"><a id="__codelineno-24-96" name="__codelineno-24-96" href="#__codelineno-24-96"></a><span class="w">                    </span><span class="k">return</span>
</span><span id="__span-24-97"><a id="__codelineno-24-97" name="__codelineno-24-97" href="#__codelineno-24-97"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-24-98"><a id="__codelineno-24-98" name="__codelineno-24-98" href="#__codelineno-24-98"></a>
</span><span id="__span-24-99"><a id="__codelineno-24-99" name="__codelineno-24-99" href="#__codelineno-24-99"></a><span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">clickUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">messageData</span><span class="p">.</span><span class="na">optString</span><span class="p">(</span><span class="s">&quot;clickUrl&quot;</span><span class="p">)</span>
</span><span id="__span-24-100"><a id="__codelineno-24-100" name="__codelineno-24-100" href="#__codelineno-24-100"></a>
</span><span id="__span-24-101"><a id="__codelineno-24-101" name="__codelineno-24-101" href="#__codelineno-24-101"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">clickUrl</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">clickUrl</span><span class="p">.</span><span class="na">isNotEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-102"><a id="__codelineno-24-102" name="__codelineno-24-102" href="#__codelineno-24-102"></a><span class="w">                    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-103"><a id="__codelineno-24-103" name="__codelineno-24-103" href="#__codelineno-24-103"></a><span class="w">                        </span><span class="kd">val</span><span class="w"> </span><span class="nv">browserIntent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Intent</span><span class="p">(</span><span class="n">Intent</span><span class="p">.</span><span class="na">ACTION_VIEW</span><span class="p">,</span><span class="w"> </span><span class="n">Uri</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="n">clickUrl</span><span class="p">))</span>
</span><span id="__span-24-104"><a id="__codelineno-24-104" name="__codelineno-24-104" href="#__codelineno-24-104"></a><span class="w">                        </span><span class="n">browserIntent</span><span class="p">.</span><span class="na">addFlags</span><span class="p">(</span><span class="n">Intent</span><span class="p">.</span><span class="na">FLAG_ACTIVITY_NEW_TASK</span><span class="p">)</span>
</span><span id="__span-24-105"><a id="__codelineno-24-105" name="__codelineno-24-105" href="#__codelineno-24-105"></a><span class="w">                        </span><span class="n">context</span><span class="p">.</span><span class="na">startActivity</span><span class="p">(</span><span class="n">browserIntent</span><span class="p">)</span>
</span><span id="__span-24-106"><a id="__codelineno-24-106" name="__codelineno-24-106" href="#__codelineno-24-106"></a><span class="w">                    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">Exception</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-107"><a id="__codelineno-24-107" name="__codelineno-24-107" href="#__codelineno-24-107"></a><span class="w">                        </span><span class="c1">// This will trigger in case there are no offers available for whatever reason</span>
</span><span id="__span-24-108"><a id="__codelineno-24-108" name="__codelineno-24-108" href="#__codelineno-24-108"></a><span class="w">                        </span><span class="n">cancelAndDismiss</span><span class="p">()</span>
</span><span id="__span-24-109"><a id="__codelineno-24-109" name="__codelineno-24-109" href="#__codelineno-24-109"></a><span class="w">                        </span><span class="k">return</span>
</span><span id="__span-24-110"><a id="__codelineno-24-110" name="__codelineno-24-110" href="#__codelineno-24-110"></a><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-24-111"><a id="__codelineno-24-111" name="__codelineno-24-111" href="#__codelineno-24-111"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-24-112"><a id="__codelineno-24-112" name="__codelineno-24-112" href="#__codelineno-24-112"></a>
</span><span id="__span-24-113"><a id="__codelineno-24-113" name="__codelineno-24-113" href="#__codelineno-24-113"></a><span class="w">                </span><span class="c1">// Dismiss the webview</span>
</span><span id="__span-24-114"><a id="__codelineno-24-114" name="__codelineno-24-114" href="#__codelineno-24-114"></a><span class="w">                </span><span class="n">dismiss</span><span class="p">()</span>
</span><span id="__span-24-115"><a id="__codelineno-24-115" name="__codelineno-24-115" href="#__codelineno-24-115"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-24-116"><a id="__codelineno-24-116" name="__codelineno-24-116" href="#__codelineno-24-116"></a><span class="w">        </span><span class="p">},</span><span class="w"> </span><span class="s">&quot;AtarInterface&quot;</span><span class="p">)</span>
</span><span id="__span-24-117"><a id="__codelineno-24-117" name="__codelineno-24-117" href="#__codelineno-24-117"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-24-118"><a id="__codelineno-24-118" name="__codelineno-24-118" href="#__codelineno-24-118"></a>
</span><span id="__span-24-119"><a id="__codelineno-24-119" name="__codelineno-24-119" href="#__codelineno-24-119"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">loadUrl</span><span class="p">(</span><span class="n">url</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-120"><a id="__codelineno-24-120" name="__codelineno-24-120" href="#__codelineno-24-120"></a><span class="w">        </span><span class="n">Logger</span><span class="p">.</span><span class="na">getInstance</span><span class="p">().</span><span class="na">i</span><span class="p">(</span><span class="s">&quot;InterstitialView: Loading URL: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">url</span><span class="p">)</span>
</span><span id="__span-24-121"><a id="__codelineno-24-121" name="__codelineno-24-121" href="#__codelineno-24-121"></a><span class="w">        </span><span class="n">webView</span><span class="p">.</span><span class="na">loadUrl</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="__span-24-122"><a id="__codelineno-24-122" name="__codelineno-24-122" href="#__codelineno-24-122"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-24-123"><a id="__codelineno-24-123" name="__codelineno-24-123" href="#__codelineno-24-123"></a>
</span><span id="__span-24-124"><a id="__codelineno-24-124" name="__codelineno-24-124" href="#__codelineno-24-124"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">show</span><span class="p">(</span><span class="n">activity</span><span class="p">:</span><span class="w"> </span><span class="n">Activity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-125"><a id="__codelineno-24-125" name="__codelineno-24-125" href="#__codelineno-24-125"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">decorView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">activity</span><span class="p">.</span><span class="na">window</span><span class="p">.</span><span class="na">decorView</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ViewGroup</span>
</span><span id="__span-24-126"><a id="__codelineno-24-126" name="__codelineno-24-126" href="#__codelineno-24-126"></a><span class="w">        </span><span class="n">decorView</span><span class="p">.</span><span class="na">addView</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
</span><span id="__span-24-127"><a id="__codelineno-24-127" name="__codelineno-24-127" href="#__codelineno-24-127"></a><span class="w">        </span><span class="n">setAlpha</span><span class="p">(</span><span class="m">0f</span><span class="p">)</span>
</span><span id="__span-24-128"><a id="__codelineno-24-128" name="__codelineno-24-128" href="#__codelineno-24-128"></a><span class="w">        </span><span class="n">animate</span><span class="p">().</span><span class="na">alpha</span><span class="p">(</span><span class="m">1f</span><span class="p">).</span><span class="na">setDuration</span><span class="p">(</span><span class="m">300</span><span class="p">).</span><span class="na">start</span><span class="p">()</span>
</span><span id="__span-24-129"><a id="__codelineno-24-129" name="__codelineno-24-129" href="#__codelineno-24-129"></a><span class="w">        </span><span class="n">contextActivity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">activity</span>
</span><span id="__span-24-130"><a id="__codelineno-24-130" name="__codelineno-24-130" href="#__codelineno-24-130"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-24-131"><a id="__codelineno-24-131" name="__codelineno-24-131" href="#__codelineno-24-131"></a>
</span><span id="__span-24-132"><a id="__codelineno-24-132" name="__codelineno-24-132" href="#__codelineno-24-132"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">cancelAndDismiss</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-133"><a id="__codelineno-24-133" name="__codelineno-24-133" href="#__codelineno-24-133"></a><span class="w">        </span><span class="c1">// Implement any custom logic for when the user cancels</span>
</span><span id="__span-24-134"><a id="__codelineno-24-134" name="__codelineno-24-134" href="#__codelineno-24-134"></a><span class="w">        </span><span class="n">dismiss</span><span class="p">()</span>
</span><span id="__span-24-135"><a id="__codelineno-24-135" name="__codelineno-24-135" href="#__codelineno-24-135"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-24-136"><a id="__codelineno-24-136" name="__codelineno-24-136" href="#__codelineno-24-136"></a>
</span><span id="__span-24-137"><a id="__codelineno-24-137" name="__codelineno-24-137" href="#__codelineno-24-137"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">dismiss</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-138"><a id="__codelineno-24-138" name="__codelineno-24-138" href="#__codelineno-24-138"></a><span class="w">        </span><span class="n">contextActivity</span><span class="o">?.</span><span class="na">runOnUiThread</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-139"><a id="__codelineno-24-139" name="__codelineno-24-139" href="#__codelineno-24-139"></a><span class="w">            </span><span class="n">animate</span><span class="p">().</span><span class="na">alpha</span><span class="p">(</span><span class="m">0f</span><span class="p">).</span><span class="na">setDuration</span><span class="p">(</span><span class="m">300</span><span class="p">).</span><span class="na">withEndAction</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">(</span><span class="n">parent</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ViewGroup</span><span class="p">).</span><span class="na">removeView</span><span class="p">(</span><span class="k">this</span><span class="p">)</span><span class="w"> </span><span class="p">}.</span><span class="na">start</span><span class="p">()</span>
</span><span id="__span-24-140"><a id="__codelineno-24-140" name="__codelineno-24-140" href="#__codelineno-24-140"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-24-141"><a id="__codelineno-24-141" name="__codelineno-24-141" href="#__codelineno-24-141"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-24-142"><a id="__codelineno-24-142" name="__codelineno-24-142" href="#__codelineno-24-142"></a><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h2 id="need-help">Need help?</h2>
<p>If you have any questions or need help, please contact us at <a href="mailto:support@atargrowth.com">support@atargrowth.com</a>.</p>







  
  




  



                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
        
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" hidden>
        
          
          <a href="../custom-api/" class="md-footer__link md-footer__link--prev" aria-label="Previous: API Integration">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                API Integration
              </div>
            </div>
          </a>
        
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["search.suggest", "search.highlight", "navigation.footer"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.ad660dcc.min.js"></script>
      
    
  </body>
</html>